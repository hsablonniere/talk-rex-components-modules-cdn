---
author: Hubert Sablonni√®re
author-twitter: @hsablonniere
author-company: Clever Cloud
hashtags: #javascript #tooling #web-components #cdn
event: Devoxx France
date: 29 septembre 2021
---

<script type="module" src="https://components.clever-cloud.com/load.js?version=7.1.0&lang=en&components=cc-input-text"></script>

# _Dans cette_ *Jungle de  l'outillage JavaScript*, _un retour √† la simplicit√© est-il encore possible ?_

## poster fade-from
> @00:00:00@
> Slide poster pour commencer

## blank black fade-to
> #Fondu au noir#
> #Voix grave et lente#
> D√©tendez vous...
> Fermez les yeux...
> #Voix narrative (Fabrice Drouelle)#
> Vous √™tes en juin 2008...
> Nadal vient de remporter son 4√®me Roland Garros face √† Roger Federer et on va pas s'mentir, le match √©tait vraiment chiant.
> Vous h√©sitez √† vous faire un cin√© mais vous ne croyez *pas* √† cette rumeur d'un 4√®me Indiana Jones.
> √Ä la place, vous d√©cidez de regarder le season finale de Lost saison 4.

## blank black
> #Chuchoter#
> OMG, il y a machin dans un cercueil !!

## blank black 
> #Voix narrative (Fabrice Drouelle)#
> Du coup : impossible de dormir.
> Vous pensez √† votre semaine de boulot qui reprend demain.
> Vous aimez votre poste de dev frontend.
<!-- > Vous aimez votre poste de dev frontend mais, -->
<!-- > #Voix grave, lente et rassurante# -->
<!-- https://www.w3counter.com/globalstats.php?year=2008&month=6 -->
<!-- > vous pestez souvent contre IE 6 et 7, et leurs 63% de part de march√©. -->
<!-- > Le plus souvent, vous bosser avec Firefox et son l√©gendaire add-on : Firebug. -->
<!-- > Ils ont quand m√™me r√©ussi √† monter √† 30 pourcents chez Mozilla. -->
<!-- > Pendant ce temps l√†, Safari et Opera se partage les miettes avec quelques pourcents chacun. -->
<!-- Dojo 2005, Prototype 2005, Mootools 2007 -->
<!-- https://jquery.org/history/ -->
<!-- > On en est √† la version 1.2.6 (mai 2008). -->
<!-- > C√¥t√© framework JavaScript, vous avez test√© Mootools et Prototype mais depuis quelques temps, vous √™tes plut√¥t team jQuery. -->
> Vous avez essay√© plusieurs frameworks JavaScript mais vous √™tes plut√¥t team jQuery.
> Gr√¢ce √† lui, les bugs d'IE ne vous font presque plus peur.

## blank black
> Vous avez besoin d'un plugin ? trop facile...
> une petite recherche et hop :
> => vous tombez sur Google Code,
> => vous copiez/collez la version minifi√©e dans votre projet,
> => vous ajoutez la balise script qui va bien,
> => et le tour est jou√©.
> Les jours de flemme vous r√©f√©rencez directement l'URL du CDN et √ßa "juste marche".
> Pas besoin de t√©l√©chargement local.

## blank black
> #Voix apais√©e et lente#
> C'est beau.
> Cette simplicit√© vous appaise et vous vous endormez paisiblement.

## blank black
> #PAUSE#
> Soudain, vous vous reveillez en sursaut !!
> #Voix √©nergique et craintive#
> Que se passe t-il ?
> Mais o√π √™tes vous ?
> Et surtout, quand √™tes vous ?

## media contain
<!-- music predator ?? https://www.youtube.com/watch?v=oXnAxydhZ8M -->
<audio src="src/music/horn.ogg">
<img src="src/img/calendar-2021.jpg">
> #Voix grave et diabolique#
> Vous venez de d√©barquer en 2021 o√π le chaos s'est install√© :

## media
<img src="src/img/nadal.jpg">
> #Voix rapide#
> Nadal a perdu 4 fois Roland Garros.

## media
<img src="src/img/lost-02.jpg">
> La fin de Lost √©tait nulle.

## media
<img src="src/img/indiana-02.webp">
> Il y a des rumeurs d'un 5√®me Indiana Jones pour 2022
> #Voix Costello Lopez#
> n'im-por-te quoi l√†.
> #Voix rapide#
> Et pour coroner le tout, depuis qu'un mec a...

<!-- ## todo
brexit
> Le Royaume Uni est sorti de l'UE. -->

<!-- ## todo
comparatif fus√©es
> On continue √† d√©r√©gler le climat mais pendant ce temps l√†, on a des milliardaires qui font un concours de "fus√©e". -->

## media
<img src="src/img/pangolin.jpg">
> ...bouff√© un pangolin √† l'autre bout de la plan√®te,

## media
<img src="src/img/antenna.jpg">
> on a tous la 5G et on voit...

## media
<img src="src/img/qrcode.jpg">
> ...des QR code partout.
> #Pause#
> Ouais je sais, c'est dingue mais vous pouvez me croire, j'ai fait mes propres recherches.
> #Clin d'oeil#
> C√¥t√© dev frontend, le monde est devenu fou :

<!-- ## todo
Chrome 63%
> Google a sorti un navigateur et domine le march√© avec 63%. -->

<!-- ## todo
Microsoft Edge
> Microsoft a abandonn√© IE pour cr√©er Edge, un navigateur bas√© sur celui de Google. -->

<!-- ## todo
iPhone = SMIC => Safari 18%
> Apple impose le moteur de Safari sur tous ses iMachins, du coup, ils sont mont√©s √† 18% (ah oui, l'iPhone co√ªte un SMIC maintenant). -->

<!-- ## todo
Firefox 5%
> En pendant ce temps l√†, notre petit panda roux ador√© est tomb√© sous la barre des 5%.
> C'est tellement triste, mais attends il y a pire : -->

## media white
<img src="src/img/rip-jquery.svg">
> #Voix sid√©r√©e#
> jQuery c'est devenu has been, genre has been de ouf.
> Maintenant, le framework √† la mode,

## media
<img src="src/img/party-react.png">
> c'est React et tout le monde fait des Single Page Application.
> Du coup, fini la simplicit√© de l'√®re jQuery.
> Noooooonnnn... maintenant, pour ajouter une d√©pendance et l'utiliser...

## image-grid
<img src="src/img/logo-closure.svg">
<img src="src/img/logo-nodejs.svg">
<img src="src/img/logo-npm.svg">
<img src="src/img/logo-browserify.svg">
<img src="src/img/logo-bower.svg">
<img src="src/img/logo-brunch.svg">
<img src="src/img/logo-grunt.svg">
<img src="src/img/logo-gulp.svg">
<img src="src/img/logo-broccoli.svg">
<img src="src/img/logo-webpack.svg">
<img src="src/img/logo-traceur.svg">
<img src="src/img/logo-typescript.svg">
<img src="src/img/logo-babel.svg">
<img src="src/img/logo-terser.svg">
<img src="src/img/logo-rollup.svg">
<img src="src/img/logo-parcel.svg">
<img src="src/img/logo-swc.svg">
<img src="src/img/logo-esbuild.svg">
<img src="src/img/logo-snowpack.svg">
<img src="src/img/logo-vitejs.svg">
<img src="src/img/logo-rome.svg">
> ...il te faut Node.js, npm, un task runner, un bundler, un transpiler, un minifier...
<!-- , un linter, un formatter... -->
> En vrai, faut un bac+17 pour s'y r'trouver dans tous ces outils JavaScript.
> #Ralentir#
> C'est devenu la jungle et j'crois vraiment qu'le moment est venu de faire le point sur la question.

## poster
> @00:02:30@
> #Voix normale et heureuse#
> Bonjour √† *toutes* et √† tous !
> J'm'appelle Hubert Sablonni√®re,
> J'suis d√©veloppeur Web chez *Clever Cloud* et aujourd'hui, j'ai envie de vous parler de jungle et d'outils JavaScript.
> #Pause#
> On va d'abord revenir sur certains concepts et termes invent√©s _ou_ popularis√©s par ces outils.
> D'ailleurs, on va se concentrer sur l'ajout de d√©pendances et le build, sinon on en a pour la s'maine.
> Ensuite, on verra au travers d'un retour d'exp√©rience, si c'est possible de revenir √† un syst√®me plus simple...
> comment... ?
> et qu'est ce que √ßa implique ?
> #Pause#
> Allez, c'est parti, on commence tout de suite par un...

<!--
Cette section sert √† expliquer des termes.
Il s'agit de techniques et fonctionnalit√©s propos√©es par les outils de build/bundler/transpiler...
L'id√©e est de (r√©)expliquer leur fonctionnement et leur but/utilit√© finale.
En soit, c'est une information int√©ressante.
De plus, √ßa resservira dans la deuxi√®me partie.
-->
## section
Guide de survie
> ...petit guide de termes √† connaitre pour survivre en milieu outils JavaScript.
> Dans les ann√©es 2000, quand on voulait am√©liorer les performances d'une page Web qui charge du JS, on faisait appel √† la...

<!-- Pour chaque terme, on va le mettre en contexte et √©noncer ce qui a amen√© le besoin d'une telle fonctionnalit√© -->
<!-- terme anim√© -->
<!-- terme + schema (progressif) : L'ID√âE => on explique ce que √ßa fait -->
<!-- terme + impact en text : LE BUT => on explique √† quoi √ßa sert -->
<!-- terme + logos : on explique qui a amen√© le concept et quand -->

## definition animation
Minification
> ...minification.

## definition todo
Minification
<!-- TODO en √©tapes et en mettant en √©vidence des lignes bleues, des commentaires en gris et des espaces en blank -->
<img src="/src/img/definition-minification.png">
> *L'ID√âE :* on prend un fichier JS,
> on enl√®ve les espaces, les commentaires... bref,
> tout ce qu'on peut pour que √ßa continue √† fonctionner pareil,
> mais avec moins de code.
> #Pause#
> C'est une sorte de compression avec perte de donn√©es.

## definition logo
Minification
<img src="/src/img/sign-limit-code.svg">

## definition
Minification
* Moins de code
* _(charger + parser + ex√©cuter)_
> *LE BUT :* reduire la quantit√© de code que le navigateur va : charger, parser et ex√©cuter.
> #Pause#
> C'est pas nouveau du tout hein.

<!-- https://www.fusioncharts.com/blog/5-excellent-javascript-minification-tools-to-improve-your-code-performance/ -->
## definition
Minification (regex)
* 2001: JSMin <img src="">
* 2004: Packer <img src="">
> Les moins jeunes se souviendront des pr√©curseurs bas√©s sur des regexs.
> C'est √† partir de 2007, qu'on a vu appara√Ætre...

## definition
Minification (parseur)
* 2007: ShrinkSafe <img src="src/img/logo-dojo.svg">
* 2007: YUI<br>compressor <img src="src/img/logo-yui.png">
* 2009: Closure<br>compiler <img src="src/img/logo-closure.svg">
* 2011: Uglify <img>
> ...des outils plus avanc√©s qui parse le code pour le minifier.
> Avant l'arriv√©e de Node.js en 2009, ces outils √©taient souvent cod√©s en Java et utilisaient Rhino comme parseur.
> C'est eux qui on amen√©...

## definition
Minification
* _"mangling"_ de noms de variable
* &nbsp;
> ...le mangling de noms variables,
> ou encore de...

## definition
Minification
* _"mangling"_ de noms de variable
* √©limination de code mort
 <!-- (DCE) -->
> ...l'√©limination de code mort.
> Aujourd'hui, les outils modernes...

## definition
Minification
* 2018: Terser (JS) <img src="src/img/logo-terser.svg">
* 2019: swc (Rust) <img src="src/img/logo-swc.svg">
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
> ...sont devenus hyper puissants et rapides, surtout les p'tits nouveaux cod√©s en Rust et en go.
<!-- > D'ailleurs si on prend le jQuery de juin 2008 minifi√© avec Packer, il fait 54 kilo. -->
<!-- > alors que si on le passe dans terser, il fait 45 kilo. -->

<!-- ## todo
TERSER:
It's not well known, but whitespace removal and symbol mangling accounts for 95% of the size reduction in minified code for most JavaScript - not elaborate code transforms. One can simply disable compress to speed up Terser builds by 3 to 4 times. -->

<!-- curl -s https://code.jquery.com/jquery-1.2.6.min.js | human-size -->
<!-- curl -s https://code.jquery.com/jquery-1.2.6.min.js | terser --compress --mangle | human-size -->
<!-- curl -s https://code.jquery.com/jquery-3.6.0.min.js | human-size -->
<!-- curl -s https://code.jquery.com/jquery-3.6.0.min.js | terser --compress --mangle | human-size -->

<!-- ## code todo
```js
const FORD_NAME = 'Harrison';
const FORD_YEAR = 1942;

function playIndianaJones (currentYear, name, year) {
    const age = currentYear - year;
    if (age > 50) {
        console.log('NOOOO, ' + name + ' is too old!');
    }
    else {
        console.log('NOOOO, the trilogy is enough.');
    }
}

playIndianaJones(2021, FORD_NAME, FORD_YEAR);
``` -->

<!-- 
{
  module: true,
  compress: {
    passes: 2,
  },
}
-->

<!-- ## code todo
```js
console.log("NOOOO, Harrison Ford is too old!");
``` -->

## blank white
> Pour des raisons de confort de dev, on a commenc√© √† s√©parer nos fichiers.
> Tant qu'on les chargeait dans le bon ordre,
> en gros tant qu'on mettait jQuery d'abord et les plugins jQuery ensuite etc...
> √ßa se passait bien.
> Du coup, pour pas d√©teriorer les perfs et l'exp√©rience utilisateur, on a commenc√© √† faire de la...

## definition animation
Concat√©nation
> ...Concat√©nation.

## definition todo
Concat√©nation
<!-- TODO en √©tapes et en mettant en √©vidence des lignes dans les fichiers -->
<img src="/src/img/definition-concatenation.png">
> *L'ID√âE :* on prend plusieurs fichiers et on les assemble en un seul fichier en respectant l'ordre.

## definition logo
Concat√©nation
<img src="/src/img/sign-limit-request.svg">

## definition
Concat√©nation
* Moins de requ√™tes HTTP
> *LE BUT :* reduire le nombre de requ√™tes HTTP.
> Avec HTTP 1.1, un navigateur ne peut pas faire + de 6 requ√™tes en parall√®le vers le m√™me site.
> Pour automatiser √ßa, on a commenc√© √† d√©gainer des...

## definition
Task runners / Pipeline
* 2011/2012: Brunch <img src="src/img/logo-brunch.svg">
* 2012: Grunt <img src="src/img/logo-grunt.svg">
* 2013: Gulp <img src="src/img/logo-gulp.svg">
* 2014: Broccoli <img src="src/img/logo-broccoli.svg">
> ...task runners et autres outils orient√©s pipeline.
> J'ai envie de dire, c'√©tait le bon vieux temps, mais je bosse encore sur une app qui utilise grunt donc bon.

## blank white
> Respecter l'odre des fichiers, c'√©tait un peu fragile du coup,
> on a commenc√© utiliser des syst√®mes de modules pour expliciter les d√©pendances.
<!-- > Le module A a besoin de module B qui lui a besoin de module C. -->
> C'est l√† qu'on est pass√© au niveau sup√©rieur de la concat√©nation...

## definition animation
Bundling
> ...le bundling.

## definition todo
Bundling
<!-- TODO en √©tapes et en mettant en √©vidence des lignes dans les fichiers et les imports, ajouter de la glue en jaune -->
<img src="/src/img/definition-bundling.png">
> *L'ID√âE :* on prend un fichier source, on analyse les d√©pendances et on les assemble dans le bon ordre, dans un seul fichier et avec un peu de glue pour que √ßa continue √† fonctionner.
> C'est une sorte de concat√©nation ++ qui connait le syst√®me de modules et qui se base sur le graphe de d√©pendances.

## definition logo
Concat√©nation
<img src="/src/img/sign-limit-request.svg">

## definition
Bundling
* Moins de requ√™tes HTTP
> *LE BUT :* toujours r√©duire le nombre de requ√™tes HTTP.
> Le graphe de d√©pendances se limite pas √† JavaScript, certains outils sont capables d'analyser les d√©pendances entres des fichiers HTML, des CSS, des images, des polices, etc.
<!-- logo cjs/esm https://github.com/wessberg/cjstoesm -->

<!-- https://github.com/google/closure-compiler/blob/7ff6e25843097791416d1544c88dc8711f6be64a/src/com/google/javascript/jscomp/deps/DepsGenerator.java -->
## definition
Bundling (pr√©curseurs)
* 2009: Closure<br>compiler <img src="src/img/logo-closure.svg">
* 2010: Builder<br>(Dojo Toolkit) <img src="src/img/logo-dojo.svg">
* 2010: r.js<br>(requirejs) <img src="src/img/logo-requirejs.svg">
* 2011: Browserify <img src="src/img/logo-browserify.svg">
> Au d√©but on faisait du bundling avec des syst√®mes de modules customs,
> puis on est pass√© sur AMD,
> et ensuite une bonne partie de la communaut√© a opt√© pour le syst√®me CommonJS (polularis√© par Node.js).
> C'est avec l'arriv√©e de...

<!-- https://github.com/google/closure-compiler/blob/7ff6e25843097791416d1544c88dc8711f6be64a/src/com/google/javascript/jscomp/deps/DepsGenerator.java -->
## definition
Bundling
* 2014: Webpack <img src="src/img/logo-webpack.svg">
* 2015: Rollup <img src="src/img/logo-rollup.svg">
* 2018: Parcel <img src="src/img/logo-parcel.svg">
> ...Webpack et ses amis qu'on a commenc√© √† avoir du support pour les modules ECMAScript.
> Webpack est clairement le plus utilis√© mais r√©put√© pour √™tre le plus relou √† configurer,
> Rollup est le seul qui sait exporter du format ESM, ECMAScript module,
> et Parcel se vante d'√™tre z√©ro config.

<!-- peut-√™tre √† la fin -->
## media todo
https://bundlers.tooling.report/
<img src="src/img/screenshot-bundlers-tooling-report.jpg" screenshot-url="https://bundlers.tooling.report/#overview">
> Si vous voulez en savoir plus sur ces outils, les √©quipes devrel de Google on fait un site comparatif avec des tableaux de qui sait faire quoi.

> Comme pour la minification...

## definition
Bundling (nouvelle g√©n√©ration)
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
* 2020: Spack (Rust) <img src="src/img/logo-swc.svg">
* 2020/2021: Rome (JS/rust) <img src="src/img/logo-rome.svg">
> ...on retrouve les petits nouveaux cod√©s en go ou en Rust et qui envoient du lourd au niveau perfs.

## media top
<img src="src/img/screenshot-esbuild.jpg" screenshot-url="https://esbuild.github.io/">
> Quand je dis lourd, c'est du tr√®s lourd.
> C'est un benchmark hein, mais esbuild est 100 fois plus rapide pour minifier et bundler.
<!-- > C'est tellement performant qu'on a vu arriver l'ann√©e derni√®re... -->

<!-- TODO cette partie, √ßa va pas -->
<!-- ## definition todo
Serveurs de dev
* 2020: WDS <img src="src/img/logo-modernweb.svg">
* 01/2020: Snowpack <img src="src/img/logo-snowpack.svg">
* 04/2020: Vite <img src="src/img/logo-vitejs.svg">
> Des outils qui utilisent esbuild sous le capot pour proposer une exp√©rience de dev ultra performante,
> et Rollup pour le build de prod un peu plus complexe. -->

## blank white
> Au fur et √† mesure bla bla on a vu apparaitre diff√©rentes techniques dans le bundling.

## definition animation
Scope hoisting
> *L'ID√âE :* simplifier la glue et l'isolation qui est n√©cessaire autour de chaque module dans le bundle final.

## definition
Scope hoisting
```js
// lib.js
export function add (a, b) {
  return a + b;
}
```
```js invisible
// index.js
import { add } from './lib.js';
console.log(add(1, 2));
console.log(add(2, 3));
```

## definition
Scope hoisting
```js
// lib.js
export function add (a, b) {
  return a + b;
}
```
```js
// index.js
import { add } from './lib.js';
console.log(add(1, 2));
console.log(add(2, 3));
```

## definition
Scope hoisting
```js small
// bundle.js - Webpack 4 SANS import hoisting
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([
  // lib.js
  function(e,t,n){"use strict";function r(e,t){return e+t}n.d(t,"a",(function(){return r}))},
  // index.js
  function(e,t,n){"use strict";n.r(t);var r=n(0);console.log(Object(r.a)(1,2)),console.log(Object(r.a)(2,3))}
]);
```

## definition
Scope hoisting
```js small
// bundle.js - Webpack 4 AVEC import hoisting
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([
  
  
  // index.js + lib.js
  function(e,t,n){"use strict";function r(e,t){return e+t}n.r(t),console.log(r(1,2)),console.log(r(2,3))}
]);
```

## definition
Scope hoisting
```js
// bundle.js - Rollup
(function () {
  'use strict';
  function add (a, b) {
    return a + b;
  }
  console.log(add(1, 2));
  console.log(add(2, 3));
})();
```

## definition
Scope hoisting
* Moins de code
* _(charger + parser + ex√©cuter)_
> *LE BUT :* reduire √† quantit√© de code que le navigateur doit : charger, parser et ex√©cuter.

## definition logo
Scope hoisting
<img src="/src/img/sign-limit-code.svg">

## definition animation
Tree shaking
<!-- il faut une vid√©o de moi qui secoue un arbre -->

## definition
Tree shaking
<img src="/src/img/definition-tree-shaking.png">
> ...le tree shaking
> C'est une technique qu'on applique au moment du bundling.
> *L'ID√âE :* on prend un fichier source, on analyse ses d√©pendances et surtout on analyse pr√©cis√©mment ce qu'il importe des d√©pendances qu'il utilise pour ne garder que ces parties dans le bundle final.

## definition
Tree shaking
* Moins de code
* _(charger + parser + ex√©cuter)_
> *LE BUT :* reduire √† quantit√© de code que le navigateur doit : charger, parser et ex√©cuter.

## definition logo
Tree shaking
<img src="/src/img/sign-limit-code.svg">

## blank white
> La transition peut se faire sur le fait qu'on a fait des m√©ga fat bundle avec √ßa

## definition animation
Code splitting

<!-- TODO: refaire le schema avec les imports dynamiques -->
## definition todo
Code splitting
<img src="/src/img/definition-code-splitting.png">
> *L'ID√âE :* ne plus produire un seule gros bundle avec tout le code et se servir des imports dynamiques pour faire plusieurs plus petits fichiers.
> On va souvent retrouver cet usage dans la d√©finition des routes d'une app.
> slash home importe dynamiquement home.js,
> slash contact importe dynamiquement contact.js
> et ainsi de suite.

## definition
Code splitting
> *LE BUT :* reduire √† quantit√© de code que le navigateur doit : charger, parser et ex√©cuter pour afficher une page.
> *LE BUT :* se reposer sur le cache pour les morceaux qu'il a d√©j√†.
* Moins de code au premier chargement
* Meilleure utilisation du cache

## definition logo
Tree shaking
<img src="/src/img/sign-limit-code.svg">

## definition logo
Tree shaking
<img src="/src/img/sign-obligation-cache.svg">

## definition animation
Import hoisting

## definition
Import hoisting
```js
// one.js
export function one () { return 1; }
```
```js
// two.js
import { one } from './one.js';
export function two () { return one() + 2; }
```
```js
// index.js
import { two } from './two.js';
console.log(two());
```

## definition
Import hoisting
* R√©duire effet escalier

## definition logo
Import hoisting
<img src="/src/img/sign-danger-stairs.svg">

## definition animation
Content hashing

## definition
Content hashing
<img src="/src/img/definition-content-hashing.png">
> ...le Content hashing.
> *L'ID√âE :* on prend le contenu de chaque fichier, on calcule un hash et on l'ajoute dans le nom du fichier.
> On a aussi appel√© √ßa du revving √† l'√©poque de grunt/gulp.

## definition
Content hashing
* Meilleure utilisation du cache
* &nbsp;

## definition
Content hashing
* Meilleure utilisation du cache
* _(navigateur, proxy, CDN...)_
> *LE BUT :* Pousser les caches √† consid√©rer les fichiers comme immutables
> Si un navigateur ou un proxy cache voit passer un fichier, il peut th√©oriquement que tel nom correspondra toujours √† tel contenu.
> Ici on vient am√©liorer l'exp√©rience des visites r√©p√©t√©es.

## definition logo
Import hoisting
<img src="/src/img/sign-obligation-cache.svg">

<!-- confort du dev -->
## definition animation
Transpiling

## definition
Transpiling
* Langage (JSX, TS...)
* &nbsp;

## definition
Transpiling
* Langage (JSX, TS...)
* Syntaxes/fonctionnalit√©s JS _"moderne"_

## definition
Transpiling
* Facilite la vie des devs

## definition
Transpiling
* 2009: CoffeeScript <img src="src/img/logo-coffeescript.svg">
* 2014: Traceur <img src="src/img/logo-traceur.svg">
* 2014: TypeScript <img src="src/img/logo-typescript.svg">
* 2014: Babel<br>(6-to-5) <img src="src/img/logo-babel.svg">

## definition
Transpiling (nouvelle g√©n√©ration)
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
* 2020: SWC (rust) <img src="src/img/logo-swc.svg">
* 2020/2021: Rome (JS/rust) <img src="src/img/logo-rome.svg">

## blank white
> Tout ces outils qui font du bundling sont capable de faire...

## definition animation
Module resolution
> ...de la r√©solution de module.
> Directement ou via un plugin.

## definition
Module resolution
```js
// bare import specifier :
import { createStore } from 'redux';
```
```js invisible
// import relatif :
import { createStore } from '../node_modules/redux/lib/redux.js';
```
> *L'ID√âE :* transformer ce qu'on appelle un `bare import specifier`, un import tout nu avec juste le nom npm,

## definition
Module resolution
```js
// bare import specifier :
import { createStore } from 'redux';
```
```js
// import relatif :
import { createStore } from '../node_modules/redux/lib/redux.js';
```
> en un chemin relatif qui pointe vers un vrai fichier.
> *LE BUT :* r√©f√©rencer directement une d√©pendance sans se soucier de savoir o√π la trouver.
> Le plus compliqu√© que √ßa en a l'air.
> Un navigateur sait faire une requ√™te vers une URL absolue ou relative mais pas vers un simple nom de packet npm.

<!-- recap -->
## todo fade-from
* Pour l'utilisateur
  * moins de code
    * minification
    * scope hoisting
    * tree shaking
    * code splitting
  * moins de requ√™tes
    * concatenation
    * bundling
  * meilleur cache
    * content hashing
    * code splitting
  * moins d'escalier
    * import hoisting
* Pour le d√©veloppeur
  * transpiling

<!-- 
C√¥t√© serveur
* Pour l'utilisateur
  * moins de requ√™tes
  * moins de code
    * compression
  * meilleur cache
    * header de cache
  * moins d'escalier
    * domain sharding
    * HTTP/2 pipelining
    * preload
    * HTTP/2 push
 -->

<!--
Cette section sert √†...
* la comlexit√© des outils (JavaScript) existe
  * trop de choix
  * difficile √† brancher entre eux
  * √ßa rend le dev frontend moins accesibles au nouveaux
* ces outils sont arriv√©es via le monde des fwk JS et SPA (le full front)
  * cela force les autres dev frontend √† adopter Node.js + npm ...
* pour autant les fonctionnalit√©s apport√©s par ces outils ont une utilit√©
> * Est-ce que c'√©tait mieux avant ? : digression sur l'utilit√© et l'impact de ces √©volutions
> ** On constate les avantages et inconv√©nients
> * ?? (1) comment r√©duire la d√©pendance √† nos outils ?
> ** Apporter un d√©but de piste
> * ?? (2) comment rendre tout ceci plus accessible ?
> ** Diff√©rents cas de figures auxquels on pourrait s'int√©resser pour simplifier l'exp√©rience de dev mais ici on va se pencher sur :
> * analogie des pizzas
-->

## blank black fade-to
> #Pause#
> #Gestes des mains de la t√™te qui explose#
> J'sais pas vous mais quand j'vois tous ces outils et ces termes, j'ai une p'tite voix d'boomer dans ma t√™te qui fait :
> #Voix de p'tit vieux#
> Oh bah franchement...

## section
C'√©tait mieux avant
> ...c'√©tait mieux avant.
> #Malaise, voix g√™n√©e#
> Euuuuuuh......
> Faut fait attention √† la nostalgie, c'est comme l'alcool, √ßa peut faire dire pas mal de b√™tises quand m√™me.
> Du coup, on va tenter de rester s√©rieux et on va se...

## text
ü§î
> ...poser objectivement la question.
> #Pause#
> D'un c√¥t√©, quand j'vois cette complexit√©...

## text
üëç
<!-- üëç Oui -->
> ...j'ai envie de r√©pondre oui.
> On ne compte plus les...

## media
<img src="src/img/screenshot-medium-js-fatigue.jpg" screenshot-url="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4">
> ...articles qui parlent de JavaScript fatigue et qui d√©crivent souvent la m√™me r√©alit√©.
> Il y a beaucoup d'outils et certains font plus ou moins la m√™me chose, du coup...

## text
üòï Choix difficiles
> ...les choix sont difficiles.
> Niveau compatibilit√©, c'est pas √©vident de les brancher entre eux, du coup...

## text
ü§¨ M√†J compliqu√©es
> ...les mises √† jour sont compliqu√©es.
> Heureusement,

## definition
* : Angular <img src="src/img/logo-angular.svg">
* : Ember <img src="src/img/logo-ember.svg">
* : React <img src="src/img/logo-react.svg">
* : Svelte <img src="src/img/logo-svelte.svg">
* : Vue <img src="src/img/logo-vue.svg">
> les frameworks JS proposent leur propre ligne de commande ou des g√©n√©rateurs de projets pre-configur√©s.
> C'est bien hein.
> C'est d'ailleurs pour √ßa qu'on choisit un framework, pour qu'il fasse des choix √† notre place et...

<!-- ## definition
* : Rome <img src="src/img/logo-rome.svg">

## media
<img src="src/img/screenshot-xkcd-927.jpg" screenshot-url="https://xkcd.com/927/" style="transform: scale(1.5); transform-origin: top center;"> -->

## text
‚è±Ô∏è Gagner du temps
> ...gagner du temps.
> Par contre, comme avec n'importe quelle couche d'abstraction, on accepte...

## text
üîê Abandonner le contr√¥le
> ...d'abandonner le contr√¥le de la cha√Æne de build.
> √áa implique...

## text
üîí Couplage code/outils fort
> un couplage fort entre notre code et les outils.
> √Ä tel point qu'aujourd'hui, plusieurs de ces frameworks ne peuvent pas √™tre utilis√©s sans la suite d'outils qui va avec.
<!-- Le premier qui me dit, bah si tu peux faire du React sans JSX -->
<!-- > D'ailleurs, si on regarde les d√©pendances propos√©es par les communaut√©s respectives de ces frameworks (plugins, composants...), -->
<!-- > la quasi totalit√© des projets ne proposent qu'une seule m√©thode d'installation : `npm install` + bundler. -->
<!-- d√©tailler la m√©thode d'installation -->

## blank white
> Au fur et √† mesure des ann√©es, je me suis habitu√© aux r√®gles de cette bulle JavaScript.
> Du coup, quand on a commenc√© n√¥tre biblioth√®que de composants chez Clever,
> j'√©tais un peu du genre :
> "Tu veux utiliser nos composants ?"

## definition
* : Node.js <img src="src/img/logo-nodejs.svg">
* : npm <img src="src/img/logo-npm.svg">
* : Webpack <img src="src/img/logo-webpack.svg">
> C'est sur npm, d√©brouille toi avec ton bundler.

## blank white
> La d√©tail important, c'est qu'on a fait le choix d'exposer des Web Components.
> Un standard du Web qui permet de dire :

## code
```js
class MyComponent extends HTMLElement {
  // ...
}
```
```js invisible
customElements.define('my-component', MyComponent);
```
```html invisible
<my-component></my-component>
```
> je d√©finis le comportement de mon composant dans une classe,

## code
```js dim
class MyComponent extends HTMLElement {
  // ...
}
```
```js
customElements.define('my-component', MyComponent);
```
```html invisible
<my-component></my-component>
```
> J'associe cette classe √† une balise HTML sp√©cifique,

## code
```js dim
class MyComponent extends HTMLElement {
  // ...
}
```
```js dim
customElements.define('my-component', MyComponent);
```
```html
<my-component foo="something">Hello</my-component>
```
> et du coup, mes utilisateurs peuvent l'utiliser comme n'importe quelle autre balise.

<!-- ## definition
* 2016: Chrome <img src="src/img/logo-chrome.svg">
* 2017: Safari <img src="src/img/logo-safari.svg">
* 2018: Firefox <img src="src/img/logo-firefox.svg"> -->
> √áa marche dans tous les navigateurs modernes,
<!-- https://caniuse.com/template -->

<!-- ## definition
* : Angular <img src="src/img/logo-angular.svg">
* : Ember <img src="src/img/logo-ember.svg">
* : React <img src="src/img/logo-react.svg">
* : Svelte <img src="src/img/logo-svelte.svg">
* : Vue <img src="src/img/logo-vue.svg"> -->
> avec tous les frameworks,

<!-- ## media
<img src="src/img/screenshot-custom-elements-everywhere-angular.jpg" screenshot-url="https://custom-elements-everywhere.com/#angular">

## media
<img src="src/img/screenshot-custom-elements-everywhere-vue.jpg" screenshot-url="https://custom-elements-everywhere.com/#vue">

## media
<img src="src/img/screenshot-custom-elements-everywhere-svelte.jpg" screenshot-url="https://custom-elements-everywhere.com/#svelte">

## media
<img src="src/img/screenshot-custom-elements-everywhere-react.jpg" screenshot-url="https://custom-elements-everywhere.com/#react"> -->
> (sauf avec React o√π il faut ajouter de la glue).

> √áa marche aussi avec des sites statiques √©crit en Markdown,
> des sites multi pages cod√©s en Java/PHP/Ruby qui font du templating c√¥t√© serveur.
<!-- √ßa marche m√™me dans des slides HTML -->

## text
üòç Web Components partout !
> Bref, √ßa marche partout quoi.
<!-- > Il n'y a pas que le JavaScript dans la vie. (je r√©p√®te) -->
> Du coup, c'est un peu culott√© d'imposer cette...

<!-- ## definition
* : Node.js <img src="src/img/logo-nodejs.svg">
* : npm <img src="src/img/logo-npm.svg">
* : Webpack <img src="src/img/logo-webpack.svg"> -->
> ...taxe "Node.js + npm + bundler" √† des professionnels du Web dont le socle ne tourne pas autour de JavaScript.

## code
```html
<script src="https://code.jquery.com/jquery-1.2.6.min.js"></script>
```
> Donc oui, d'une certaines mani√®re, c'√©tait mieux avant quand on mettais juste une balise vers le CDN de jQuery.
<!-- > C'est d'ailleurs ce que font la majorit√© des bilbioth√®ques : moment, charts.js,  -->

## text
üëé
<!-- üëé Non -->
> De l'autre c√¥t√© ... quand je regarde les gains de perf qu'apportent tous ces outils, j'ai envie de r√©pondre non, c'√©tait *pas* mieux avant.
<!-- jquery terser -->
> Ma biblioth√®que de composants, c'est pas juste une seule fichier.
> Si une personne veut utiliser uniquement le composant `<cc-input-text>`, en fran√ßais,
> son bundler va appliquer toutes les techniques qu'on a √©voqu√© pour produire le plus petit morceau de code possible et assurer les meilleurs perfs pour l'utilisateur.
> En mode CDN, je fais quoi ?
> #Pause#
> Je vais √™tre oblig√© de dire :
> "Tiens, voici un m√©ga fichier avec tous les composants, toutes leurs d√©pendances et toutes les langues. Amuse toi bien !".
> Les perfs vont √™tre nulles.
> En plus, quand cette personne passera sur une nouvelle version, il y aura des nouveaux composants, √ßa sera encore plus lourd.

## text no-emoji
√áa d√©pend <sup>‚Ñ¢Ô∏è</sup>
> En fait, elle est relou cette question.
> Nous ce qu'on veut savoir, c'est :
> est-ce que c'est possible de retrouver...

## text
üçï Simplicit√©
> ...la simplicit√© du mode balise script vers un CDN,

## text
üë®‚Äçüç≥ Performances
> mais avec les m√™mes performances que si on avait utilis√© un bundler et tous ces machins.
> C'est ce qu'on a essay√© de faire chez Clever Cloud, petit retour d'exp√©rience
<!-- > => DIY / PnP -->

## section
<!-- Un nouvel espoir... -->
<!-- Retour d'exp√©rience -->
<!-- Vers la simplicit√©<br>et au del√† ? -->
Retour √† la simplicit√©...

## media logo
<img src="src/img/logo-clever-cloud.svg">

## todo
Les composants chez Clever Cloud

## demo-html
```html
<cc-input-text value="my s3cr3t" secret clipboard></cc-input-text>
```
<cc-input-text value="my s3cr3t" secret clipboard style="font-size: 2em; width: 14em"></cc-input-text>
> contexte Clever Cloud: web components, besoins internes divers, besoins externes

## media
<img src="src/img/screenshot-clever-components-storybook.jpg" screenshot-url="https://www.clever-cloud.com/doc/clever-components/?path=/story/%F0%9F%8F%A0-home-readme--page">

## media
<img src="src/img/screenshot-clever-components-github.jpg" screenshot-url="https://github.com/CleverCloud/clever-components">

## todo
> Pour les utiliser dans la console, une SPA, il faut : (lister toutes les √©tapes avec node.js machin)
> parler aussi des √©tapes de mise en prod :
> compression, header de cache, h1/h2/h3...

## todo
> on veut utiliser nos composant ailleurs que dans des SPA
> MPA Play/Scala, Wordpress, site statique
> on veut que des clients ou des partenaires puisse les utiliser le plus facilement possible

## todo
DIY vs Plug-and-Play
> explication du DIY (je sais ce que je fais, je veux la maitrise)
> explication du Plug-and-play (je veux pas prendre cette complexit√© √† ma charge, √ßa ne vaut pas le coup, donne moi le meilleur r√©sultat possible)
> analogie pizza

## todo
> ici le DIY, c'est ce qu'on a d√©j√† √©voqu√©
> le plug-and-play, finalement, √ßa serait plut√¥t une approche √† la jQuery avec juste des balises script

## todo
> pr√©cisons qu'il n'y a rien de bien nouveau
> on avait d√©j√† des CDN publics avant
> ce qui a chang√©, c'est qu'aujourd'hui, certains d'entre eux sont un peu plus smart
> ils ont une connaissance de npm
> resolution des bare imports
> semver
> polyfill
> compression
> jspm, unpkg, skypack
> l'autre truc qui a chang√©, c'est qu'on ne peut plus se reposer sur le cache partag√© d'un CDN

## media
<img src="src/img/screenshot-jspm.jpg" screenshot-url="https://jspm.org/">

## media
<img src="src/img/screenshot-unpkg.jpg" screenshot-url="https://unpkg.com/">

## media
<img src="src/img/screenshot-skypack.jpg" screenshot-url="https://www.skypack.dev/">

## todo
> mais du coup, qu'est ce que √ßa implique dans notre cas particulier ce mode plug and play ?
> expliquer qu'on utilise ESM et on publie sur npm en ESM
> maintenant c'est support√© dans les browsers
> du coup, √ßa marche sans rien faire

<!-- https://modernizr.com/download?ambientlight-audio-batteryapi-setclasses -->

## definition
Exemple support
* 89: Chrome <img src="src/img/logo-chrome.svg">
* 89: Firefox <img src="src/img/logo-firefox.svg">
* 89: Safari <img src="src/img/logo-safari.svg">

## todo
> par contre, on doit quant m√™me demander √† nos utilisateurs de mettre une balise script par composant
> en plus c'est pas minifi√© √† 100% (CSS, JS)
> √ßa ne g√®re pas tjs les images (SVG et sans oublier la minification)
> + le i18n avec le boilerplate de setup de langue (si c'est n√©cessaire)

## todo
> id√©e, est-ce qu'on ne pourrait pas faire notre propre smart CDN
> et avoir une seule balise script pour les gouverner tous

## todo
> allez, c'est parti
> on va commencer par le pire cas possible
> et on va mesurer

## todo
> Source individual ES modules (raw unminified)
> Minify JavaScript
> Minify inlined HTML templates and CSS
> Minify SVG
> Enable treeshaking
> Shim unused stuffs from 3rd parties
> Enable gzip
> Enable brotli
<!-- > Keep alive TODO?? -->
<!-- > domain sharding TODO?? -->
<!-- > Enable HTTP/2 TODO?? -->
<!-- > Enable HTTP/3 TODO?? -->
> Code splitting (chunks)
> Code splitting (manual chunks)
> Hoist imports (rollup system)
> Hoist imports (JS depcache reverse order)
> Hoist imports (JS depcache reverse order dynamic import)
> Hoist imports (JS depcache reverse order dynamic import + preload SVG)
<!-- > Preload with Link header TODO?? -->
<!-- > HTTP/2 push TODO?? -->
> comparer √† tout dans le bundle
> comparer √† un bundle s√©lectif

## todo
> la cerise sur le gateau
> c'est l'auto i18n au besoin
> la bonne gestion du cache entre versions
> (pourrait mieux faire avec les import maps)
 
## todo
> serveiller les import maps
> serveiller les web bundles / resource bundles https://github.com/WICG/resource-bundles

## todo
> expliquer la mise en place du Cellar + endpoint dynamique chez CF

## section
Et apr√®s ?
> en fait, de la m√™me mani√®re qu'avec notre plateforme Cloud, on essaye de convaincre les gens de pas se prendre la t√™te avec les serveurs, les mises √† jour, la s√©cu tout √ßa et de nous le d√©l√©guer car on sait faire
> ici on vient d√©placer la connaissance et la complexit√© de "prodification" de l'app qui consomme √† celui qui expose un lib de composants
> comme vous l'avez vu, c'est pas forc√©ment la meilleure solution, mais on trouve que dans pas mal de cas, le r√©sultat est sufisant comparer √† cout de mise en place et maintenance
> on esp√®re que √ßa vous donnera des id√©es
> ouverture sur le d√©placement de qui own le bundling ? (as a service)
> ouverture sur web bundles (new name)
> ouverture sur le bundling √† la vol√©e

## todo
conclusion
> Le monde du JavaScript est devenu un peu fou.
> Cette jungle d'outils est dense et seuls les plus "veille" peuvent s'y retrouver.
> √áa n'est pas une situation acceptable et il faut rester vigilants.
> Entre ceux qui disent que c'√©tait mieux avant et les drogu√©s aux derniers outils √† la mode, il faut trouver un juste milieu.
> Il faut chercher le bon curseur pour atteindre des bonnes performances pour les utilisateurs tout en
> .√† tel point qu'il devient utile de se poser pour faire le point sur ce vaste √©cosyst√®me.
> Le Web est bien plus vaste que le petit monde des SPAs cod√©es avec le dernier framework JS √† la mode.
> Le Web c'est pour tout le monde et il n'y a pas de raisons que √ßa devienne un club r√©serv√© √† une √©lite californienne.
> Il faut faire attention √† ne pas trop se reposer sur nos s√©ries d'outils et √©viter les "oui mais √ßa tout le monde connait".

## poster
*Merci beaucoup !* _vous √™tes un super public..._
> notes for empty slide (line 1)

## credits

Liens :

* Source des composants : https://github.com/CleverCloud/clever-components
* Storybook des composants : https://www.clever-cloud.com/doc/clever-components/
* UI pour s√©lectionner : https://components.clever-cloud.com/
* Smart CDN source : https://github.com/CleverCloud/clever-components-cdn

Images :

* Fond jungle : https://www.vexels.com/vectors/preview/70035/tropical-frame-styled-jungle-background
* Calendrier 2021 : https://unsplash.com/photos/F32jPy9SMaw
* 2021 masques : https://unsplash.com/photos/q5BnGgt2Y_E
* Fond f√™te : https://www.vecteezy.com/vector-art/237001-party-crowd
* Pangolin : https://unsplash.com/photos/mtTpAM2uaRM
* Antenne : https://unsplash.com/photos/31JqyCVndUM
* QR code : https://unsplash.com/photos/2HWkORIX3II

Polices :

* Tintin : https://www.cufonfonts.com/font/tintin
* PT Sans : https://fonts.google.com/specimen/PT+Sans
* Anton : https://fonts.google.com/specimen/Anton

Sons :

* Marimba note : https://www.youtube.com/watch?v=8FJMTJmuoU8
* Horn sound effect : https://www.youtube.com/watch?v=gKz1X2rn3CQ
* Forest sound : https://www.youtube.com/watch?v=IsPBplWLImI

Liens :

* https://fr.wikibooks.org/wiki/Code_de_la_route/Liste_des_panneaux