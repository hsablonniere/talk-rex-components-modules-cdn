---
author: Hubert Sablonnière
author-twitter: @hsablonniere
author-company: Clever Cloud
hashtags: #javascript #tooling #web-components #cdn
event: BBL chez Gravitee
date: 15 octobre 2021
---

<script type="module" src="https://components.clever-cloud.com/load.js?version=7.1.0&lang=en&components=cc-input-text"></script>

# _Dans cette_ *Jungle de  l'outillage JavaScript*, _un retour à la simplicité est-il encore possible ?_

## poster fade-from
> @00:00:00@
> Slide poster pour commencer

## blank black fade-to
> #Fondu au noir#
> #Voix grave et lente#
> Détendez vous...
> Fermez les yeux...
> #Voix narrative (Fabrice Drouelle)#
> Vous êtes en juin 2008...
> Nadal vient de remporter son 4ème Roland Garros face à Roger Federer et on va pas s'mentir, le match était vraiment chiant.
> Vous hésitez à vous faire un ciné mais vous ne croyez *pas* à cette rumeur d'un 4ème Indiana Jones.
> À la place, vous décidez de regarder le season finale de Lost saison 4.

## blank black
> #Chuchoter#
> OMG, il y a machin dans un cercueil !!

## blank black 
> #Voix narrative (Fabrice Drouelle)#
> Du coup : impossible de dormir.
> Vous pensez à votre semaine de boulot qui reprend demain.
> Vous aimez votre poste de dev frontend.
<!-- > Vous aimez votre poste de dev frontend mais, -->
<!-- > #Voix grave, lente et rassurante# -->
<!-- https://www.w3counter.com/globalstats.php?year=2008&month=6 -->
<!-- > vous pestez souvent contre IE 6 et 7, et leurs 63% de part de marché. -->
<!-- > Le plus souvent, vous bosser avec Firefox et son légendaire add-on : Firebug. -->
<!-- > Ils ont quand même réussi à monter à 30 pourcents chez Mozilla. -->
<!-- > Pendant ce temps là, Safari et Opera se partage les miettes avec quelques pourcents chacun. -->
<!-- Dojo 2005, Prototype 2005, Mootools 2007 -->
<!-- https://jquery.org/history/ -->
<!-- > On en est à la version 1.2.6 (mai 2008). -->
<!-- > Côté framework JavaScript, vous avez testé Mootools et Prototype mais depuis quelques temps, vous êtes plutôt team jQuery. -->
> Vous avez essayé plusieurs frameworks JavaScript mais vous êtes plutôt team jQuery.
> Grâce à lui, les bugs d'IE ne vous font presque plus peur.

## blank black
> Vous avez besoin d'un plugin ? trop facile...
> une petite recherche et hop :
> => vous tombez sur Google Code,
> => vous copiez/collez la version minifiée dans votre projet,
> => vous ajoutez la balise script qui va bien,
> => et le tour est joué.
> Les jours de flemme vous référencez directement l'URL du CDN et ça "juste marche".
> Pas besoin de téléchargement local.

## blank black
> #Voix apaisée et lente#
> C'est beau.
> Cette simplicité vous appaise et vous vous endormez paisiblement.

## blank black
> #PAUSE#
> Soudain, vous vous reveillez en sursaut !!
> #Voix énergique et craintive#
> Que se passe t-il ?
> Mais où êtes vous ?
> Et surtout, quand êtes vous ?

## media contain
<!-- music predator ?? https://www.youtube.com/watch?v=oXnAxydhZ8M -->
<audio class="global" src="src/music/horn.ogg">
<img src="src/img/calendar-2021.jpg">
> #Voix grave et diabolique#
> Vous venez de débarquer en 2021 où le chaos s'est installé :

## media
<img src="src/img/nadal.jpg">
> #Voix rapide#
> Nadal a perdu 4 fois Roland Garros.

## media
<img src="src/img/lost-02.jpg">
> La fin de Lost était nulle.

## media
<img src="src/img/indiana-02.webp">
> Il y a des rumeurs d'un 5ème Indiana Jones pour 2022
> #Voix Costello Lopez#
> n'im-por-te quoi là.
> #Voix rapide#
> Et pour coroner le tout, depuis qu'un mec a...

<!-- ## todo
brexit
> Le Royaume Uni est sorti de l'UE. -->

<!-- ## todo
comparatif fusées
> On continue à dérégler le climat mais pendant ce temps là, on a des milliardaires qui font un concours de "fusée". -->

## media
<img src="src/img/pangolin.jpg">
> ...bouffé un pangolin à l'autre bout de la planète,

## media
<img src="src/img/antenna.jpg">
> on a tous la 5G et on voit...

## media
<img src="src/img/qrcode.jpg">
> ...des QR code partout.
> #Pause#
> Ouais je sais, c'est dingue mais vous pouvez me croire, j'ai fait mes propres recherches.
> #Clin d'oeil#
> Côté dev frontend, le monde est devenu fou :

<!-- ## todo
Chrome 63%
> Google a sorti un navigateur et domine le marché avec 63%. -->

<!-- ## todo
Microsoft Edge
> Microsoft a abandonné IE pour créer Edge, un navigateur basé sur celui de Google. -->

<!-- ## todo
iPhone = SMIC => Safari 18%
> Apple impose le moteur de Safari sur tous ses iMachins, du coup, ils sont montés à 18% (ah oui, l'iPhone coûte un SMIC maintenant). -->

<!-- ## todo
Firefox 5%
> En pendant ce temps là, notre petit panda roux adoré est tombé sous la barre des 5%.
> C'est tellement triste, mais attends il y a pire : -->

## media white
<img src="src/img/rip-jquery.svg">
> #Voix sidérée#
> jQuery c'est devenu has been, genre has been de ouf.
> Maintenant, le framework à la mode,

## media
<img src="src/img/party-react.png">
> c'est React et tout le monde fait des Single Page Application.
> Du coup, fini la simplicité de l'ère jQuery.
> Noooooonnnn... maintenant, pour ajouter une dépendance et l'utiliser...

## image-grid
<img src="src/img/logo-closure.svg">
<img src="src/img/logo-nodejs.svg">
<img src="src/img/logo-npm.svg">
<img src="src/img/logo-browserify.svg">
<img src="src/img/logo-bower.svg">
<img src="src/img/logo-brunch.svg">
<img src="src/img/logo-grunt.svg">
<img src="src/img/logo-gulp.svg">
<img src="src/img/logo-broccoli.svg">
<img src="src/img/logo-webpack.svg">
<img src="src/img/logo-traceur.svg">
<img src="src/img/logo-typescript.svg">
<img src="src/img/logo-babel.svg">
<img src="src/img/logo-terser.svg">
<img src="src/img/logo-rollup.svg">
<img src="src/img/logo-parcel.svg">
<img src="src/img/logo-swc.svg">
<img src="src/img/logo-esbuild.svg">
<img src="src/img/logo-snowpack.svg">
<img src="src/img/logo-vitejs.svg">
<img src="src/img/logo-rome.svg">
> ...il te faut Node.js, npm, un task runner, un bundler, un transpiler, un minifier...
<!-- , un linter, un formatter... -->
> En vrai, faut un bac+17 pour s'y r'trouver dans tous ces outils JavaScript.
> #Ralentir#
> C'est devenu la jungle et j'crois vraiment qu'le moment est venu de faire le point sur la question.

## poster
> @00:02:30@
> #Voix normale et heureuse#
> Bonjour à *toutes* et à tous !
> J'm'appelle Hubert Sablonnière,
> J'suis développeur Web chez *Clever Cloud* et aujourd'hui, j'ai envie de vous parler de jungle et d'outils JavaScript.
> #Pause#
> On va d'abord revenir sur certains concepts et termes inventés _ou_ popularisés par ces outils.
> D'ailleurs, on va se concentrer sur l'ajout de dépendances et le build, sinon on en a pour la s'maine.
> Ensuite, on verra au travers d'un retour d'expérience, si c'est possible de revenir à un système plus simple...
> comment... ?
> et qu'est ce que ça implique ?
> #Pause#
> Allez, c'est parti, on commence tout de suite par un...

<!--
Cette section sert à expliquer des termes.
Il s'agit de techniques et fonctionnalités proposées par les outils de build/bundler/transpiler...
L'idée est de (ré)expliquer leur fonctionnement et leur but/utilité finale.
En soit, c'est une information intéressante.
De plus, ça resservira dans la deuxième partie.
-->
## section
Guide de survie
> @00:03:10@
> ...petit guide de termes à connaitre pour survivre en milieu outils JavaScript.
> Dans les années 2000, quand on voulait améliorer les performances d'une page Web qui charge du JS, on faisait appel à la...

<!-- Pour chaque terme, on va le mettre en contexte et énoncer ce qui a amené le besoin d'une telle fonctionnalité -->
<!-- terme animé -->
<!-- terme + schema (progressif) : L'IDÉE => on explique ce que ça fait -->
<!-- terme + impact en text : LE BUT => on explique à quoi ça sert -->
<!-- terme + logos : on explique qui a amené le concept et quand -->

## definition animation
Minification
> ...minification.

## definition
Minification
<img src="/src/img/definition-minification-01.svg">
> *L'IDÉE :* on prend un fichier JS,

## definition
Minification
<img src="/src/img/definition-minification-02.svg">
> on enlève les espaces, les commentaires... bref,
> tout ce qu'on peut pour que ça continue à fonctionner pareil,
> mais avec moins de code.
> #Pause#
> C'est une sorte de compression avec perte de données.

## definition logo
Minification
<img src="/src/img/sign-limit-code.svg">
> *LE BUT :* reduire la quantité de code que le navigateur va : charger, parser et exécuter.

## definition
Minification
* Moins de code
* _(charger + parser + exécuter)_
> #Pause#
> C'est pas nouveau du tout hein.

<!-- https://www.fusioncharts.com/blog/5-excellent-javascript-minification-tools-to-improve-your-code-performance/ -->
## definition
Minification (regex)
* 2001: JSMin <img src="">
* 2004: Packer <img src="">
> Les moins jeunes se souviendront des précurseurs basés sur des regexs.
> C'est à partir de 2007, qu'on a vu apparaître...

## definition
Minification (parseur)
* 2007: ShrinkSafe <img src="src/img/logo-dojo.svg">
* 2007: YUI<br>compressor <img src="src/img/logo-yui.png">
* 2009: Closure<br>compiler <img src="src/img/logo-closure.svg">
* 2011: Uglify <img>
> ...des outils plus avancés qui parse le code pour le minifier.
> Avant l'arrivée de Node.js en 2009, ces outils étaient souvent codés en Java et utilisaient Rhino comme parseur.
> C'est eux qui on amené...

## definition
Minification
* _"mangling"_ de noms de variable
* &nbsp;
> ...le mangling de noms variables,
> ou encore de...

## definition
Minification
* _"mangling"_ de noms de variable
* élimination de code mort
 <!-- (DCE) -->
> ...l'élimination de code mort.
> Aujourd'hui, les outils modernes...

## definition
Minification
* 2018: Terser (JS) <img src="src/img/logo-terser.svg">
* 2019: swc (Rust) <img src="src/img/logo-swc.svg">
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
> ...sont devenus hyper puissants et rapides, surtout les p'tits nouveaux codés en Rust et en go.
<!-- > D'ailleurs si on prend le jQuery de juin 2008 minifié avec Packer, il fait 54 kilo. -->
<!-- > alors que si on le passe dans terser, il fait 45 kilo. -->

<!-- ## todo
TERSER:
It's not well known, but whitespace removal and symbol mangling accounts for 95% of the size reduction in minified code for most JavaScript - not elaborate code transforms. One can simply disable compress to speed up Terser builds by 3 to 4 times. -->

<!-- curl -s https://code.jquery.com/jquery-1.2.6.min.js | human-size -->
<!-- curl -s https://code.jquery.com/jquery-1.2.6.min.js | terser --compress --mangle | human-size -->
<!-- curl -s https://code.jquery.com/jquery-3.6.0.min.js | human-size -->
<!-- curl -s https://code.jquery.com/jquery-3.6.0.min.js | terser --compress --mangle | human-size -->

## blank white
> Pour des raisons de confort de dev, on a commencé à séparer nos fichiers.
> Tant qu'on les chargeait dans le bon ordre,
> en gros tant qu'on mettait jQuery d'abord et les plugins jQuery ensuite etc, ça se passait bien.
> Du coup, pour pas déteriorer les perfs et l'expérience utilisateur, on a commencé à faire de la...

## definition animation
Concaténation
> ...Concaténation.

## definition
Concaténation
<img src="/src/img/definition-concatenation-01.svg">
> *L'IDÉE :* on prend plusieurs fichiers et...

## definition
Concaténation
<img src="/src/img/definition-concatenation-02.svg">
> ...on les assemble en un seul fichier en respectant l'ordre.

## definition logo
Concaténation
<img src="/src/img/sign-limit-request.svg">
> *LE BUT :* reduire le nombre de requêtes HTTP.
> Avec HTTP 1.1, un navigateur ne peut pas faire + de 6/8 requêtes en parallèle vers le même site.
> Pour automatiser ça, on a commencé à dégainer des...

<!-- ## definition
Concaténation
* Moins de requêtes HTTP -->

## definition
Task runners / Pipeline
* 2011/2012: Brunch <img src="src/img/logo-brunch.svg">
* 2012: Grunt <img src="src/img/logo-grunt.svg">
* 2013: Gulp <img src="src/img/logo-gulp.svg">
* 2014: Broccoli <img src="src/img/logo-broccoli.svg">
> ...task runners et autres outils orientés pipeline.
> J'ai envie de dire, c'était le bon vieux temps, mais je bosse encore sur une app qui utilise grunt donc bon.

## blank white
> Respecter l'ordre des fichiers, c'était un peu fragile du coup,
> on a commencé utiliser des systèmes de modules pour expliciter les dépendances.
<!-- > Le module A a besoin de module B qui lui a besoin de module C. -->
> C'est là qu'on est passé au niveau supérieur de la concaténation...

## definition animation
Bundling
> ...le bundling.

## definition
Bundling
<img src="/src/img/definition-bundling-01.svg">
> *L'IDÉE :* on prend un fichier source, on analyse les dépendances et...

## definition
Bundling
<img src="/src/img/definition-bundling-02.svg">
> ...on les assemble dans le bon ordre, dans un seul fichier (et avec un peu de glue pour que ça continue à fonctionner).
> C'est une sorte de concaténation ++ qui connait le système de modules et qui se base sur le graphe de dépendances.
> Ce graphe se limite pas à JavaScript, certains outils sont capables d'analyser les dépendances entres des fichiers HTML, des CSS, des images, des polices, etc.

## definition logo
Concaténation
<img src="/src/img/sign-limit-request.svg">
> *LE BUT :* toujours réduire le nombre de requêtes HTTP.

<!-- ## definition
Bundling
* Moins de requêtes HTTP -->
<!-- logo cjs/esm https://github.com/wessberg/cjstoesm -->

<!-- https://github.com/google/closure-compiler/blob/7ff6e25843097791416d1544c88dc8711f6be64a/src/com/google/javascript/jscomp/deps/DepsGenerator.java -->
## definition
Bundling (précurseurs)
* 2009: Closure<br>compiler <img src="src/img/logo-closure.svg">
* 2010: Builder<br>(Dojo Toolkit) <img src="src/img/logo-dojo.svg">
* 2010: r.js<br>(requirejs) <img src="src/img/logo-requirejs.svg">
* 2011: Browserify <img src="src/img/logo-browserify.svg">
> Au début on faisait du bundling avec des systèmes de modules customs,
> puis on est passé sur AMD,
> et ensuite une bonne partie de la communauté a opté pour le système CommonJS (polularisé par Node.js).
> C'est avec l'arrivée de...

## definition
Bundling
* 2014: Webpack <img src="src/img/logo-webpack.svg">
* 2015: Rollup <img src="src/img/logo-rollup.svg">
* 2018: Parcel <img src="src/img/logo-parcel.svg">
> ...Webpack et ses amis qu'on a commencé à avoir du support pour les modules ECMAScript.
> Webpack est clairement le plus utilisé mais réputé pour être le plus relou à configurer,
> Rollup est le seul qui sait exporter du format ESM, ECMAScript module,
> et Parcel se vante d'être zéro config.

<!-- TODO peut-être à la fin -->
## media
https://bundlers.tooling.report/
<img src="src/img/screenshot-bundlers-tooling-report.jpg" screenshot-url="https://bundlers.tooling.report/#overview">
> Si vous voulez en savoir plus sur ces outils, les équipes devrel de Google on fait un site comparatif avec des tableaux de qui sait faire quoi.

> Comme pour la minification...

## definition
Bundling (nouvelle génération)
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
* 2020: Spack (Rust) <img src="src/img/logo-swc.svg">
* 2020/2021: Rome (JS/rust) <img src="src/img/logo-rome.svg">
> ...on retrouve les petits nouveaux codés en go ou en Rust et qui envoient du lourd au niveau perfs.

## media top
<img src="src/img/screenshot-esbuild.jpg" screenshot-url="https://esbuild.github.io/">
> Quand je dis lourd, c'est du très lourd.
> C'est un benchmark hein, mais esbuild est 100 fois plus rapide pour minifier et bundler.
<!-- > C'est tellement performant qu'on a vu arriver l'année dernière... -->

<!-- TODO cette partie, ça va pas -->
<!-- ## definition
Serveurs de dev
* 2020: WDS <img src="src/img/logo-modernweb.svg">
* 01/2020: Snowpack <img src="src/img/logo-snowpack.svg">
* 04/2020: Vite <img src="src/img/logo-vitejs.svg">
> Des outils qui utilisent esbuild sous le capot pour proposer une expérience de dev ultra performante,
> et Rollup pour le build de prod un peu plus complexe. -->

## blank white
> Quand la concurrence des outils c'est intensifié (surtout avec l'arrivée de Rollup),
> on a vu apparaitre des nouvelles techniques lié au bundling comme...

## definition animation
Scope hoisting
> ...le scope hoisting.
> *L'IDÉE :* simplifier la glue et l'isolation qui est nécessaire autour de chaque module dans le bundle final.

## definition
Scope hoisting
```js
// lib.js
export function add (a, b) {
  return a + b;
}
```
```js invisible
// index.js
import { add } from './lib.js';
console.log(add(1, 2));
console.log(add(2, 3));
```
> Si j'ai un fichier lib avec une fonction add

## definition
Scope hoisting
```js
// lib.js
export function add (a, b) {
  return a + b;
}
```
```js
// index.js
import { add } from './lib.js';
console.log(add(1, 2));
console.log(add(2, 3));
```
> et un fichier index qui l'importe pour l'utiliser.
> Ça fait 2 modules.

## definition
Scope hoisting
```js small
// bundle.js - Webpack 4 SANS import hoisting
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([
  // lib.js
  function(e,t,n){"use strict";function r(e,t){return e+t}n.d(t,"a",(function(){return r}))},
  // index.js
  function(e,t,n){"use strict";n.r(t);var r=n(0);console.log(Object(r.a)(1,2)),console.log(Object(r.a)(2,3))}
]);
```
> Sans import hoisting, Webpack 4 va produire ce genre de truc.
> Une bonne grosse glue au début et ensuite les 2 modules, emballé dans des fonctions.

## definition
Scope hoisting
```js small
// bundle.js - Webpack 4 AVEC import hoisting
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([
  
  
  // index.js + lib.js
  function(e,t,n){"use strict";function r(e,t){return e+t}n.r(t),console.log(r(1,2)),console.log(r(2,3))}
]);
```
> Si on active le scope hoisting, on va venir hisser la fonction add dans le même scope que le fichier index.
> Dans cet exemple, ça change pas de ouf avec la glue de Webpack mais...

## definition
Scope hoisting
```js
// bundle.js - Rollup
(function () {
  'use strict';
  function add (a, b) {
    return a + b;
  }
  console.log(add(1, 2));
  console.log(add(2, 3));
})();
```
> Rollup (ou Webpack 5) par exemple sont capables de le faire avec quasi aucun code superflu.

## definition logo
Scope hoisting
<img src="/src/img/sign-limit-code.svg">
> *LE BUT :* reduire à quantité de code que le navigateur doit : charger, parser et exécuter.
> On continue sur les techniques de bundling avec...

## definition animation
Tree shaking
<!-- il faut une vidéo de moi qui secoue un arbre -->
> ...le tree shaking.

## definition
Tree shaking
<img src="/src/img/definition-tree-shaking-01.svg">
> *L'IDÉE :* on prend un fichier source, on analyse ses dépendances et surtout on analyse précisémment ce qu'il importe des dépendances qu'il utilise

## definition
Tree shaking
<img src="/src/img/definition-tree-shaking-02.svg">
> pour ne garder que ces parties là dans le bundle final.

## definition logo
Tree shaking
<img src="/src/img/sign-limit-code.svg">
> *LE BUT :* reduire à quantité de code que le navigateur doit : charger, parser et exécuter.
> Autre technique que je trouve assez cool qui est très liée aux SPA et au routing côté client, c'est...

## definition animation
Code splitting
> ...le code splitting.

## definition
Code splitting
<img src="/src/img/definition-code-splitting-a-00.svg">
> En fait, sans code splitting, quand vous bundle une app, on se retrouver avec tout le code dans un seul bundle.
> *L'IDÉE :* ne plus produire un seule gros bundle avec le code de toute l'application,

## definition
Code splitting
<img src="/src/img/definition-code-splitting-a-01.svg">
> en se servant des imports dynamique pour...

## definition
Code splitting
<img src="/src/img/definition-code-splitting-a-02.svg">
> ...faire plusieurs plus petits fichiers.
> Du coup, on se retrouve avec un point d'entrée qui contient la logique de routage et qui va charger le bon module en fonction de l'URL.

## definition
Code splitting
<img src="/src/img/definition-code-splitting-b.svg">
> Si jamais un module est utilisé par plusieurs pages, il est mis à part dans un "chunk".

<!-- ## definition
Code splitting
* Moins de code au premier chargement
* &nbsp;

## definition
Code splitting
* Moins de code au premier chargement
* Meilleure utilisation du cache -->

## definition logo
Code splitting
<img src="/src/img/sign-limit-code.svg">
> *LE BUT :* reduire à quantité de code que le navigateur doit : charger, parser et exécuter pour afficher une page,

## definition logo
Code splitting
<img src="/src/img/sign-obligation-cache.svg">
> et se reposer sur le cache pour les morceaux qu'il a déjà.
> On termin avec une dernière technique de bundling...

## definition animation
Import hoisting
> ...l'import hoisting.

## definition
Import hoisting
```js
// one.js
export function one () { return 1; }
```
```js invisible
// two.js
import { one } from './one.js';
export function two () { return one() + 2; }
```
```js invisible
// index.js
import { two } from './two.js';
console.log(two());
```
> Si on a un fichier one,

## definition
Import hoisting
```js
// one.js
export function one () { return 1; }
```
```js
// two.js
import { one } from './one.js';
export function two () { return one() + 2; }
```
```js invisible
// index.js
import { two } from './two.js';
console.log(two());
```
> et un fichier two qui import one,

## definition
Import hoisting
```js
// one.js
export function one () { return 1; }
```
```js
// two.js
import { one } from './one.js';
export function two () { return one() + 2; }
```
```js
// index.js
import { two } from './two.js';
console.log(two());
```
> et un fichier principal qui import two.
> Si à la fin du bundling, ces 3 fichiers restes séparés.
> Le navigateur, va charger index, puis two, puis one.

## code
```js
// index.js
import './one.js';
import { two } from './two.js';
console.log(two());
```
> *L'IDÉE :* c'est de remonter l'import vers one vers le haut.

<!-- ## definition
Import hoisting
* Réduire effet escalier -->

## definition logo
Import hoisting
<img src="/src/img/sign-danger-stairs.svg">
> *LE BUT :* Réduire l'effet escalier et déclencher les requêtes plus tôt.

## blank white
> Dernière technique qui va se baser sur le graphe de dépendances...

## definition animation
Content hashing
> ...le content hashing.

## definition
Content hashing
<img src="/src/img/definition-content-hashing-01.svg">
> *L'IDÉE :* on prend le contenu de chaque fichier,
> On a aussi appelé ça du revving à l'époque de grunt/gulp.

## definition
Content hashing
<img src="/src/img/definition-content-hashing-02.svg">
> on calcule un hash et on l'ajoute dans le nom du fichier.

## definition
Content hashing
<img src="/src/img/definition-content-hashing-03.svg">
> Si le contenu du fichier change,

## definition
Content hashing
<img src="/src/img/definition-content-hashing-04.svg">
> Le nom du fichier change.

<!-- ## definition
Content hashing
* Meilleure utilisation du cache
* &nbsp;

## definition
Content hashing
* Meilleure utilisation du cache
* _(navigateur, proxy, CDN...)_ -->

## definition logo
Content hashing
<img src="/src/img/sign-obligation-cache.svg">
> *LE BUT :* Pousser les caches à considérer les fichiers comme immutables
> Si un navigateur ou un proxy cache voit passer un fichier, il peut théoriquement que tel nom correspondra toujours à tel contenu.
> Ici on vient améliorer l'expérience des visites répétées.

## blank white
> Il reste 2 points que je veux évoquer qui contrairement à ce qu'on a vu depuis le début n'ont pas vraiment d'impact sur les perfs de l'utilisateur final.

## definition animation
Module resolution
> ...la résolution de module.

## definition
Module resolution
```js
// "bare import specifier" :
import { createStore } from 'redux';
```
```js invisible
// import relatif :
import { createStore } from '../node_modules/redux/lib/redux.js';
```
> *L'IDÉE :* transformer ce qu'on appelle un `bare import specifier`, un import tout nu avec juste le nom npm,

## definition
Module resolution
```js
// "bare import specifier" :
import { createStore } from 'redux';
```
```js
// import relatif :
import { createStore } from '../node_modules/redux/lib/redux.js';
```
> en un chemin relatif qui pointe vers un vrai fichier.
> *LE BUT :* référencer directement une dépendance sans se soucier de savoir où la trouver.
> Le plus compliqué que ça en a l'air.
> Un navigateur sait faire une requête vers une URL absolue ou relative mais pas vers un simple nom de packet npm.

## definition
Module resolution
* Faciliter la vie des devs

<!-- confort du dev -->
## definition animation
Transpiling

## definition
Transpiling
* Langage (JSX, TS...)
* &nbsp;
> *L'IDÉE :* transformer du code qui n'est pas du JavaScript en JavaScript

## definition
Transpiling
* Langage (JSX, TS...)
* Syntaxes/fonctionnalités JS _"moderne"_
> ou encore transformer du code moderne en code plus ancien.

## definition
Transpiling
* Faciliter la vie des devs
> *LE BUT :* utiliser des langages alternatifs ou des fonctionnalités modernes du languages.

## definition
Transpiling
* 2009: CoffeeScript <img src="src/img/logo-coffeescript.svg">
* 2014: Traceur <img src="src/img/logo-traceur.svg">
* 2014: TypeScript <img src="src/img/logo-typescript.svg">
* 2014: Babel<br>(6-to-5) <img src="src/img/logo-babel.svg">

## definition fade-from
Transpiling (nouvelle génération)
* 2020: esbuild (go) <img src="src/img/logo-esbuild.svg">
* 2020: SWC (Rust) <img src="src/img/logo-swc.svg">
* 2020/2021: Rome (JS/Rust) <img src="src/img/logo-rome.svg">

<!-- recap -->
<!-- ## todo fade-from
* Pour l'utilisateur
  * moins de code
    * minification
    * scope hoisting
    * tree shaking
    * code splitting
  * moins de requêtes
    * concatenation
    * bundling
  * meilleur cache
    * content hashing
    * code splitting
  * moins d'escalier
    * import hoisting
* Pour le développeur
  * transpiling -->

<!-- 
Côté serveur
* Pour l'utilisateur
  * moins de requêtes
  * moins de code
    * compression
  * meilleur cache
    * header de cache
  * moins d'escalier
    * domain sharding
    * HTTP/2 pipelining
    * preload
    * HTTP/2 push
 -->

<!--
Cette section sert à :
* OUI, c'était mieux avant
  * les outils sont trop compliqués
  * les frameworks font gagner du temps mais vérouillent
  * du coup, on s'enferme dans le Node.js+npm+Webpack
  * Quand tu fais des WC, c'est pour tout les devs Web,
  * On peut pas imposer Node.js+npm+Webpack à tout le monde
* NON, c'était PAS mieux avant
  * Ces outils apportent des vraies améliorations de perf pour les utilisateurs
* Ça dépend, est-ce que c'est possible d'avoir les avantages sans les inconvénients ?
  * L'accesibilité et la simplicité de la balise CDN
  * Les performances des outils configurés aux max
-->
## blank black fade-to
> @00:14:00@
> #Pause#
> #Gestes des mains de la tête qui explose#
> J'sais pas vous mais quand j'vois tous ces outils et ces termes, j'ai une p'tite voix d'boomer dans ma tête qui fait :
> #Voix de p'tit vieux#
> Oh bah franchement...

## section
C'était mieux avant
> ...c'était mieux avant.
> #Malaise, voix gênée#
> Euuuuuuh......
> Faut fait attention à la nostalgie, c'est comme l'alcool, ça peut faire dire pas mal de bêtises quand même.
> Du coup, on va tenter de rester sérieux et on va se...

## text
🤔
> ...poser objectivement la question.
> #Pause#
> D'un côté, quand j'vois cette complexité...

## text
👍
<!-- 👍 Oui -->
> ...j'ai envie de répondre oui.
> On ne compte plus les...

## media
<img src="src/img/screenshot-medium-js-fatigue.jpg" screenshot-url="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4">
> ...articles qui parlent de JavaScript fatigue et qui décrivent souvent la même réalité.
> Il y a beaucoup d'outils et certains font plus ou moins la même chose, du coup...

## text
😕 Choix difficiles
> ...les choix sont difficiles.
> Niveau compatibilité, c'est pas évident de les brancher entre eux, du coup...

## text
🤬 MàJ compliquées
> ...les mises à jour sont compliquées.
> Heureusement,

## definition
* : Angular <img src="src/img/logo-angular.svg">
* : Ember <img src="src/img/logo-ember.svg">
* : React <img src="src/img/logo-react.svg">
* : Svelte <img src="src/img/logo-svelte.svg">
* : Vue <img src="src/img/logo-vue.svg">
> les frameworks JS proposent leur propre ligne de commande ou des générateurs de projets pre-configurés.
> C'est bien hein.
> C'est d'ailleurs pour ça qu'on choisit un framework, pour qu'il fasse des choix à notre place et...

## text
⏱️ Gagner du temps
> ...gagner du temps.
> Par contre, comme avec n'importe quelle couche d'abstraction, on accepte...

## text
🔐 Abandonner le contrôle
> ...d'abandonner le contrôle de la chaîne de build.
> Ça implique...

## text
🔒 Couplage code/outils fort
> un couplage fort entre notre code et les outils.
> À tel point qu'aujourd'hui, plusieurs de ces frameworks ne peuvent pas être utilisés sans la suite d'outils qui va avec.
> (Le premier qui me dit, bah si tu peux faire du React sans JSX)
<!-- > D'ailleurs, si on regarde les dépendances proposées par les communautés respectives de ces frameworks (plugins, composants...), -->
<!-- > la quasi totalité des projets ne proposent qu'une seule méthode d'installation : `npm install` + bundler. -->
<!-- détailler la méthode d'installation -->

## blank white
> Au fur et à mesure des années, je me suis habitué aux règles de cette bulle JavaScript.
> Du coup, quand on a commencé notre bibliothèque de composants chez Clever,
> la solution évidente, c'était :
> "Tu veux utiliser nos composants ?"

## definition
* : Node.js <img src="src/img/logo-nodejs.svg">
* : npm <img src="src/img/logo-npm.svg">
* : Webpack <img src="src/img/logo-webpack.svg">
> Bah t'installe Node.js,
> Tu fais un npm install,
> et après tu te débrouilles avec ton bundler.

## definition
* : Web Components <img src="src/img/logo-webcomponents.svg">
> La détail important, c'est qu'on a fait le choix d'exposer des Web Components.
> Un standard du Web qui permet de dire :

## code
```js
class MyComponent extends HTMLElement {
  // ...
}
```
```js invisible
customElements.define('my-component', MyComponent);
```
```html invisible
<my-component></my-component>
```
> je définis le comportement de mon composant dans une classe,

## code
```js dim
class MyComponent extends HTMLElement {
  // ...
}
```
```js
customElements.define('my-component', MyComponent);
```
```html invisible
<my-component></my-component>
```
> J'associe cette classe à un nom de balise HTML spécifique,

## code
```js dim
class MyComponent extends HTMLElement {
  // ...
}
```
```js dim
customElements.define('my-component', MyComponent);
```
```html
<my-component foo="something">Hello</my-component>
```
> et du coup, mes utilisateurs peuvent l'utiliser comme n'importe quelle autre balise.

<!-- ## definition
* 2016: Chrome <img src="src/img/logo-chrome.svg">
* 2017: Safari <img src="src/img/logo-safari.svg">
* 2018: Firefox <img src="src/img/logo-firefox.svg"> -->
> Ça marche dans tous les navigateurs modernes,
<!-- https://caniuse.com/template -->

<!-- ## definition
* : Angular <img src="src/img/logo-angular.svg">
* : Ember <img src="src/img/logo-ember.svg">
* : React <img src="src/img/logo-react.svg">
* : Svelte <img src="src/img/logo-svelte.svg">
* : Vue <img src="src/img/logo-vue.svg"> -->
> avec tous les frameworks,

<!-- ## media
<img src="src/img/screenshot-custom-elements-everywhere-angular.jpg" screenshot-url="https://custom-elements-everywhere.com/#angular">

## media
<img src="src/img/screenshot-custom-elements-everywhere-vue.jpg" screenshot-url="https://custom-elements-everywhere.com/#vue">

## media
<img src="src/img/screenshot-custom-elements-everywhere-svelte.jpg" screenshot-url="https://custom-elements-everywhere.com/#svelte">

## media
<img src="src/img/screenshot-custom-elements-everywhere-react.jpg" screenshot-url="https://custom-elements-everywhere.com/#react"> -->
> (sauf avec React où il faut ajouter de la glue).

> Ça marche aussi avec des sites statiques écrit en Markdown,
> des sites multi pages codés en Java/PHP/Ruby qui font du templating côté serveur.
<!-- ça marche même dans des slides HTML -->

## text
😍 Web Components partout !
> Bref, ça marche partout quoi.
> Du coup, c'est un peu culotté d'imposer cette...

<!-- ## text
🚽 WC partout ! -->

<!-- ## definition
* : Node.js <img src="src/img/logo-nodejs.svg">
* : npm <img src="src/img/logo-npm.svg">
* : Webpack <img src="src/img/logo-webpack.svg"> -->
> ...taxe "Node.js + npm + bundler" à des professionnels du Web dont le socle ne tourne pas autour de JavaScript.
<!-- > Il n'y a pas que le JavaScript dans la vie. (je répète) -->

## code
```html
<script src="https://code.jquery.com/jquery-1.2.6.min.js"></script>
```
> Donc oui, d'une certaines manière, c'était mieux avant quand on mettait juste une balise vers le CDN de jQuery.
<!-- > C'est d'ailleurs ce que font la majorité des bilbiothèques : moment, charts.js,  -->

## blank white
> De l'autre côté ... quand j'vois les gains de perf qu'apportent tous ces outils, j'ai envie de répondre...

## text
👎
<!-- 👎 Non -->
> ...non, c'était *pas* mieux avant.
<!-- jquery terser -->
> Ma bibliothèque de composants, c'est pas juste un seul fichier.
> Si une personne veut utiliser uniquement le composant `&lt;cc-input-text>`, en français,
> son bundler va appliquer toutes les techniques qu'on a évoqué pour produire le plus petit morceau de code possible et assurer les meilleurs perfs pour l'utilisateur.
> En mode CDN, je fais quoi ?
> J'ignore complètement le contexte dans lequel le composant va être utilisé.
> #Pause#
> Du coup, je vais être obligé de dire :
> "Tiens navigateur, charge moi ce méga fichier JS avec tous les composants, toutes leurs dépendances et toutes les langues. Amuse toi bien !".

## image-grid
<img src="/src/img/sign-limit-code.svg">
<img src="/src/img/sign-limit-request.svg">
<img src="/src/img/sign-obligation-cache.svg">
<img src="/src/img/sign-danger-stairs.svg">
> Les perfs vont être nulles.
> En plus, à chaque nouvelle version qui ajoute un composant, le bundle sera encore plus lourd.

## text
🤷‍♂️ Ça dépend <sup>TM</sup>
> En fait, elle est relou cette question.
> Nous ce qu'on veut savoir, c'est :
> est-ce que c'est possible de retrouver...

## text
🍕 Simplicité
> ...la simplicité du mode balise script vers un CDN,

## text
👨‍🍳 Performances
> mais avec les mêmes performances que si on avait utilisé un bundler et tous ces machins.
> C'est ce qu'on a essayé de faire chez Clever Cloud, petit retour d'expérience

<!--
Cette section sert à présenter ce qu'on a mis en place chez Clever :
* démarche de réflexion, contexte, choix...
* démarche d'analyse et de mesure
* conclusions
* DIY / PnP
-->
## section
> @00:18:30@
Retour à la simplicité...

## media logo
<img src="src/img/logo-clever-cloud.svg">
> contexte clever cloud

## text
🎉 On recrute !!

## media
<img src="src/img/screenshot-clever-components-github.jpg" screenshot-url="https://github.com/CleverCloud/clever-components">
> on a décidé de construite une bibliothèque de composants dans un projet à part
> en OSS sur GitHub
> pour dans un premier temps les utiliser nous dans notre console d'admin
> SPA legacy, jquery, lodash, bacon...
> et avec aussi pour but que nos clients et partenaires puissent les utiliser

## definition
* : JavaScript <img src="src/img/logo-javascript.svg">
* : Lit <img src="src/img/logo-lit.svg">
<!-- * : WDS <img src="src/img/logo-modernweb.svg">
* : Rollup <img src="src/img/logo-rollup.svg"> -->
> Composants codés en JS + Lit (LitElement) pour faire des WC

## media
<img src="src/img/screenshot-cc-storybook.png" browser-url="https://www.clever-cloud.com/doc/clever-components/?path=/story/%F0%9F%8F%A0-home-readme--page">
> On expose et on documente nos composants avec Storybook
> il est dispo publiquement si vous êtes curieux

## media
<img src="src/img/screenshot-cc-storybook-input-text.png" browser-url="https://www.clever-cloud.com/doc/clever-components/?path=/story/%F0%9F%A7%AC-atoms-cc-input-text--clipboard-and-secret">
> composants bas niveau (input text, button...)

## media
<img src="src/img/screenshot-cc-storybook-tile-requests.png" browser-url="https://www.clever-cloud.com/doc/clever-components/?path=/story/%F0%9F%9B%A0-overview-cc-tile-requests--default-story">
> composants métier, plus haut niveau (graph)

## media
<img src="src/img/screenshot-cc-storybook-logsmap.png" browser-url="https://www.clever-cloud.com/doc/clever-components/?path=/story/%F0%9F%9B%A0-maps-cc-logsmap--default-story">
> composants métier, plus haut niveau (la carte peut-être)

## blank white
> Quand on s'est lancé dans cette expérimentation pour mettre à dispo nos composants en mode CDN

## text
🧐 CDN existants ?
> on a regardé ce qui se faisait.
> en fait, j'ai passé bcp temps à dire que tout le monde faisait du Node.js + npm install + bundler
> clairement, dans le monde fermé des aficionados du JS et des SPA, c'est très vrai
> mais dès qu'on regarde des bibliothèques plus grand public :
> moment, leaflet, axios, lodash, d3...
> ils ont tous une doc d'install/usage via CDN
> la grosse différence, c'est que c'est principalement des projets qui se distribuent
> en un seul fichier et qui n'ont pas de dépendances

## media
<img src="src/img/screenshot-cdnjs.png" screenshot-url="https://cdnjs.com/libraries">
<!-- https://github.com/date-fns/date-fns/issues/1780 -->
<!-- https://github.com/cdnjs/packages/blob/master/packages/m/moment.js.json -->
> On va retrouver du CDNJS.
> Pour être sur CDNJS, il faut faire une PR par contre si vous avez pas un build avec un seul fichier, c'est mort.

## text
💾 646 kio (min)
> ts les composants en anglais
> curl -s https://cdn-demo-components.example-foo.com/custom-config-all-bundle-treeshake-english-min-js-html-css-svg/all-bundle.js | human-size

## text
🏋️‍♀️ 646 kio (min)

<!-- ## text
🏋️‍♀️ 185 kio (min+gzip)

## text
🏋️‍♀️ 151 kio (min+brotli) -->

## media
<img src="src/img/screenshot-jsdelivr.jpg" screenshot-url="https://www.jsdelivr.com/">
> JS delivr, c'est pas mal car ils proposent n'importe quel projet dispo sur npm
> minification automatique si nécessaire
> ils gèrent les images
> il gèrent le semver

## media
<img src="src/img/screenshot-jsdelivr-cc-file-list.jpg" screenshot-url="https://cdn.jsdelivr.net/npm/@clevercloud/components@7.2.0/dist/">
> on peut voir les fichiers en mode listing

## media
<img src="src/img/screenshot-jsdelivr-cc-input-text.jpg" screenshot-url="https://cdn.jsdelivr.net/npm/@clevercloud/components@7.2.0/dist/atoms/cc-input-text.js">
> pas de module resolving sur les import 'lit-element'

## media
<img src="src/img/screenshot-jsdelivr-esm-run.jpg" screenshot-url="https://www.jsdelivr.com/esm">
<!-- https://github.com/jsdelivr/jsdelivr/issues/18263 -->

## media
<img src="src/img/screenshot-jsdelivr-cc-input-text-esm.jpg" screenshot-url="https://cdn.jsdelivr.net/npm/@clevercloud/components@7.2.0/dist/atoms/cc-input-text.js/+esm">
> fin 2020 annonce d'un mode ESM
> module resolving
> aucun bundling

## media
<img src="src/img/screenshot-unpkg.jpg" screenshot-url="https://unpkg.com/">
> C'est pas nouveau
> gère les images
> module module ESM avec ?module
> tjs aucun bundling

## media
<img src="src/img/screenshot-jspm.jpg" screenshot-url="https://jspm.org/">
<!-- https://github.com/guybedford -->
> Guy Bedford fait des trucs autour de ça avec jspm
> C'est lui qui est derrière System JS
> C'est d'ailleurs Monsieur modules dans le monde de JS
> ne gère pas les images
> d'ailleurs ici, jspm va essayer de regrouper les fichiers en fonction du "exports" de votre package.json
> pas d'images

## media
<img src="src/img/screenshot-skypack.jpg" screenshot-url="https://www.skypack.dev/">
> auto polyfill

## media
<img src="src/img/screenshot-skypack-cc-components.jpg" screenshot-url="https://www.skypack.dev/view/@clevercloud/components">

## blank white
> mais ça fera pas le bundle comme je veux
> pas évident de tester, il faut republier à chaque fois
> les lib tierces seront tjs à part
> cascade assez lourde
> bcp de redirs
> je vais pas profiter de la minification (template, CSS)
> pas tjs de support d'image :-(

## text
😟 Domaine/origine tiers

## code
```html
<script type="module" src="??"></script>
```
> De plus, je vais pas pouvoir retrouver la simplicité de la mono balise...

## code
```html
<script type="module">                                                            


  
  
  
  
  
  
  
  
  
</script>
```
> un fichier par composant
> setup des langues

## code
```html
<script type="module">
  import * as fr from '@clevercloud/components@7.2.0/dist/translations/translations.fr.js';
  import { addTranslations, setLanguage } from '@clevercloud/components@7.2.0/dist/lib/i18n.js';
  
  
  
  
  
  
  
</script>
```

## code
```html
<script type="module">
  import * as fr from '@clevercloud/components@7.2.0/dist/translations/translations.fr.js';
  import { addTranslations, setLanguage } from '@clevercloud/components@7.2.0/dist/lib/i18n.js';
  
  import '@clevercloud/components@7.2.0/dist/atoms/cc-input-text.js';
  import '@clevercloud/components@7.2.0/dist/atoms/cc-toggle.js';
  import '@clevercloud/components@7.2.0/dist/overview/cc-title-requests.js';
  
  
  
</script>
```

## code
```html
<script type="module">
  import * as fr from '@clevercloud/components@7.2.0/dist/translations/translations.fr.js';
  import { addTranslations, setLanguage } from '@clevercloud/components@7.2.0/dist/lib/i18n.js';
  
  import '@clevercloud/components@7.2.0/dist/atoms/cc-input-text.js';
  import '@clevercloud/components@7.2.0/dist/atoms/cc-toggle.js';
  import '@clevercloud/components@7.2.0/dist/overview/cc-title-requests.js';
  
  addTranslations(fr.lang, fr.translations);
  setLanguage(fr.lang);
</script>
```

## text
😎 Créons notre propre smart CDN

## code
```html
<script src="https://example.com/" type="module"></script>
```
> notre cible

## code
```html
<script src="https://example.com/?components=cc-input-text" type="module"></script>
```

## code
```html
<script src="https://example.com/?components=cc-input-text,cc-toggle" type="module"></script>
```

## code
```html
<script src="https://example.com/?components=cc-input-text,cc-toggle&lang=fr" type="module"></script>
```

## code
```html
<script src="https://example.com/?components=cc-input-text,cc-toggle&lang=fr &version=7" type="module"></script>
```
> Pour ça, on peut faire un petit endpoint dynamique et l'héberger chez nous.
> et pour les fichiers, on peut très bien les mettre sur un...

## definition
* : Rollup <img src="src/img/logo-rollup.svg">

## text
🗃️ Object storage

## media
<img src="src/img/screenshot-cc-site-cellar.jpg" screenshot-url="https://www.clever-cloud.com/en/cellar-s3-hosting">
> ...object storage
> et mettre un CDN devant

## media
<img src="src/img/screenshot-demo-components-example-foo-simple.jpg" screenshot-url="https://demo-components.example-foo.com/custom-config-dedicated-bundle-treeshake-english-min-js-html-css-svg/simple.html">
> on a préparé plusieurs pages types pour faire des tests

## media
<img src="src/img/screenshot-demo-components-example-foo-multiple-one.jpg" screenshot-url="https://demo-components.example-foo.com/custom-config-dedicated-bundle-treeshake-english-min-js-html-css-svg/multiple.html#one">

## media
<img src="src/img/screenshot-demo-components-example-foo-multiple-two.jpg" screenshot-url="https://demo-components.example-foo.com/custom-config-dedicated-bundle-treeshake-english-min-js-html-css-svg/multiple.html#two">

## media
<img src="src/img/screenshot-demo-components-example-foo-multiple-three.jpg" screenshot-url="https://demo-components.example-foo.com/custom-config-dedicated-bundle-treeshake-english-min-js-html-css-svg/multiple.html#three">

## blank white
<!-- expliquer la démarche de test avec les différentes variantes -->
> on s'est dit vu qu'on utilise que des standards,
> on va commencer par mettre nos sources sur un object storage
> on va itérer la dessus et améliorer les perfs
> le seul truc non standard dans notre code source, c'est des bare import specifier

## code
```js
// Cette syntaxe est spécifique à un outil de bundling
import backupSvg from '../assets/backup.svg;
```
```js invisible
// Cette syntaxe fonctionne dans un navigateur sans outil
const backupSvg = new URL('../assets/backup.svg', import.meta.url).href;
```

## code
```js
// Cette syntaxe est spécifique à un outil de bundling
import backupSvg from '../assets/backup.svg;
```
```js
// Cette syntaxe fonctionne dans un navigateur sans outil
const backupSvg = new URL('../assets/backup.svg', import.meta.url).href;
```

## text
⚗️ Tester, mesurer, améliorer...

## media
<img src="src/img/screenshot-web-page-test.jpg" screenshot-url="https://www.webpagetest.org/">

## media contain
<video src="src/videos/wpt-dedicated-vs-split-raw-h1.mp4" controls></video>
> => TODO, j'ai pas le dedicated bundle raw
> => c'est la cata

## definition logo
HTTP/2 (multiplexing)
<img src="/src/img/sign-danger-stairs.svg">

## media contain
<video src="src/videos/wpt-split-raw_h1-h2.mp4" controls></video>
comparaison split raw HTTP 1.1 vs HTTP/2 (multi 3)
> depuis qu'HTTP/2 est sorti
> on parle bcp du multiplexing et du fait qu'on puisse balancer plusieurs requêtes HTTP en même temps sur la même connexion TCP
> on a a même entendu, le bundling et les sprites, c'est terminé
> OK, vérifions
> clairement, ça va pas suffire
> ah, il reste une technique plutôt réglage serveur

## media contain
<img src="src/img/wpt-split_h1-h2.png">

## definition logo
Compression (brotli)
<img src="/src/img/sign-limit-code.svg">

## media contain
<video src="src/videos/wpt-split-raw-h2_none-brotli.mp4" controls></video>
comparaison split raw HTTP/2 none/gzip/brotli (multi 3)
> c'est la compression
> quantité de donnée à charge (mais même quantité à parser et exécuter)

## media contain
<img src="src/img/wpt-split-raw-h2_none-brotli-bytes.png">

## media contain
<img src="src/img/wpt-split-raw-h2_none-brotli-progress.png">

## definition logo
Minification
<img src="/src/img/sign-limit-code.svg">

## media contain
<video src="src/videos/wpt-split-h2-br_raw-min.mp4" controls></video>
> JS
> HTML/CSS dans les templates
> SVG, c'est tjs ça de pris
> quantité de donnée à charge (mais même quantité à parser et exécuter)

## media contain
<img src="src/img/wpt-split-h2-br_raw-min-bytes.png">

## media contain
<img src="src/img/wpt-split-h2-br_raw-min-progress.png">

## definition logo
Tree shaking
<img src="/src/img/sign-limit-code.svg">

## media contain
<img src="src/img/wpt-min_treeshake-bytes.png">

## media contain
<img src="src/img/wpt-min_treeshake-progress.png">
> mouais, ça vire pas grand chose dans notre cas précis car on utilise pas

## media contain
<img src="src/img/wpt-min_treeshake-shim-bytes.png">

## media contain
<img src="src/img/wpt-min_treeshake-shim-progress.png">
> on gagne un peu plus quand on vire nous même moment et un truc de lit

## definition logo
Code splitting
<img src="/src/img/sign-limit-request.svg">

## media contain
<img src="src/img/wpt-code-plitting-requests.png">

## media contain
<img src="src/img/wpt-code-plitting-progress.png">
> en fait on va bundler
> on va même forcer les chunks
> avec ça on commence à être pas mal

## definition logo
Import hoisting
<img src="/src/img/sign-danger-stairs.svg">

## code
```js
// config i18n
import './i18n.js'
// import components
import './component-three.js';
import './component-two.js';
import './component-one.js';
```

## media
<img src="src/img/screenshot-github-cc-components-rollup-manifest.jpg" screenshot-url="https://github.com/CleverCloud/clever-components/blob/master/rollup/rollup-plugin-deps-manifest.js">

## code
```json
{
  "manifestVersion": "1",
  "packageVersion": "7.2.0",
  "files": [
    {}
  ]
}
```

## code
```json
{
  "id": "cc-input-text",
  "path": "cc-input-text-7c6457f7.js",
  "dependencies": [
    "vendor-5e139a4e.js",
    "i18n-446ebe81.js",
    "default-theme-fead272a.js",
    "assets/clipboard-bf8d5491.svg",
    "..."
  ],
  "sources": [
    "src/atoms/cc-input-text.js"
  ]
},
```

## code
```json
{
  "id": "",
  "path": "vendor-5e139a4e.js",
  "dependencies": [],
  "sources": [
    "node_modules/lit-html/lib/part.js",
    "node_modules/lit-element/lit-element.js",
    "...",
    "src/lib/events.js",
    "src/styles/skeleton.js",
    "src/styles/waiting.js"
  ]
},
```

## media contain
<img src="src/img/wpt-import-hoisting-0-1-2-progress.png">
> statique
> dynamique
> pour faire ça, on va devoir analyser les dépendances

## media contain
<video src="src/videos/wpt-dedicated-vs-split-h2-min-br-hoist2.mp4" controls></video>

## code
```js
// config i18n
import './i18n.js'
// import components (dynamic)
import('./component-three.js');
import('./component-two.js');
import('./component-one.js');
```

## media contain
<video src="src/videos/wpt-dedicated-vs-split-h2-min-br-hoist4.mp4" controls></video>

## media
<img src="src/img/screenshot-demo-components-example-foo.jpg" screenshot-url="https://demo-components.example-foo.com/">

## media
<img src="src/img/screenshot-demo-components-dashboard.jpg" screenshot-url="https://demo-components.example-foo.com/__dashboard__">

## white blank

## media
<img src="src/img/screenshot-github-cc-component-cdn.jpg" screenshot-url="https://github.com/CleverCloud/clever-components-cdn/">

## media
<img src="src/img/screenshot-cc-components-cdn-script-ex-01.jpg" screenshot-url="https://components.clever-cloud.com/load.js?version=7.2.0&lang=en&components=cc-input-text">

## blank white
> montrer des exemples sans i18n

## blank white
> montrer des exemples AVEC i18n

## blank white
> montrer le semver

## blank white
> expliquer la subtilité ne pas avoir la version dans les chemins

## blank white
> chaque fichier est servis avec un cache
> montrer le cache (via la demo jsbin)
> y compris le load.js quand c'est possible

## media
<img src="src/img/screenshot-jakearchibald-multiple-versions-same-time.jpg" screenshot-url="https://jakearchibald.com/2020/multiple-versions-same-time/">
<!-- Avantage d'avoir toutes les versions (article jake) -->

## media
<img src="src/img/screenshot-cc-components-ui.png" browser-url="https://components.clever-cloud.com/">
> Montrer la UI de sélection et faire une démo avec JSBin

## code
```html
<script type="module" src="https://components.clever-cloud.com/load.js?magic-mode=dont-use-this-in-prod"></script>
```

## text
👩‍🔧 Admin (Play/Scala)
<!-- Contexte Clever après : maintenant, on utilise ce smart CDN sur le site WP, la doc Hugo et une app interne Play/Scala -->

## text
🎓 Documentation (Hugo)

## media
<img src="src/img/screenshot-cc-doc-cellar.png" browser-url="https://www.clever-cloud.com/doc/deploy/addon/cellar/">
> Montrer des exemples de la doc ou du site de clever

## text
🧮 Page tarifs (WordPress)

## media
<img src="src/img/screenshot-cc-site-pricing-cellar.png" browser-url="https://www.clever-cloud.com/en/pricing">
> Montrer des exemples de la doc du nouveau site de clever

## section
> @00:42:00@
à suivre...
> Détendez vous...
> Nous sommes toujours en 2021 et clairement, cette jungle d'outils est bien installée.
> Ça va continuer à bouger car on a encore de l'innovation.

<!-- ## media
<img src="src/img/screenshot-import-maps.png" screenshot-url="https://github.com/WICG/import-maps">

## media
<img src="src/img/screenshot-resource-bundle.png" screenshot-url="https://github.com/WICG/resource-bundles"> -->

## definition
Serveurs de dev
* 2020: WDS <img src="src/img/logo-modernweb.svg">
* 01/2020: Snowpack <img src="src/img/logo-snowpack.svg">
* 04/2020: Vite <img src="src/img/logo-vitejs.svg">
> On a vu arriver depuis un peu plus d'un an, des outils qui apportent des grosses différences sur l'expérience de dev,
> des temps de rechargement en phase de dev quasi instantanés sur des gros projets.
> esbuild et rust
> Webpack ne survivra que s'il est continué à être utilisé par les gros frameworks et Vue a déjà dit au revoir.

## definition
* : Rome <img src="src/img/logo-rome.svg">
> On a des outils qui promettent de faciliter les choses et de faire tout en un.
> Sur le papier, c'est cool, surtout depuis qu'ils ont décidé de faire une refonte de zéro en Rust.
> L'autre truc intriguant, c'est qu'ils ont levé 4.5 millions.

## media
<img src="src/img/screenshot-rome-tools-inc.jpg" screenshot-url="https://rome.tools/blog/announcing-rome-tools-inc/">

## media
<img src="src/img/screenshot-xkcd-927.jpg" screenshot-url="https://xkcd.com/927/" style="transform: scale(1.5); transform-origin: top center;">
> Par contre, ça fait un peu, il y a trop d'outils, c'est compliqué, on va faire un nouvel outil.
> On peut aussi se demander si cette génération d'outils en go ou Rust va pas freiner un peu les gens comme moi qui font leurs propres outils en JS.

## blank white
> Pour moi, la méthode la plus résiliente est d'avoir une base de code qui n'est pas trop liée à une suite d'outils.
> Une base de code qui évite les syntaxes et fonctionnalités spécifiques à un bundler ou autre.
> C'est une histoire de compromis mais notre projet de Web Components en est un très bon exemple.

## blank white
> C'est pas simple de s'y retrouver mais *NON*, c'était pas mieux avant.
> Ces outils apportent des vraies fonctionnalités qui peuvent améliorer les performances de nos utilisateurs.

## blank white
> Dans le cas de figure que j'ai évoqué :
> _exposer un design system ou une bibliothèque de composants à plusieurs applications dans un SI par exemple,_
> ça me parait vraiment intéressant d'essayer de revenir à la simplicité d'une balise unique vers un CDN,
> c'est une manière de déplacer la complexité et le savoir des outils de build de ceux qui consomment à celui qui expose les composants.

## text
🍕 Plug-and-Play
> Une approche Plug and play
> Donne moi le meilleur truc possible en mode simple et rapide

## text
👨‍🍳 Performances
> Do It Yourself
> Une approche DIY
> Je sais ce que je fais donne moi le controle

## blank white
> on peut arriver à des résultats pas trop mal mais il y a des inconvénients.
> ne me croyez pas, mesurer vous même dans votre propre contexte.
> non, HTTP/2 n'a pas tué le bundling loin de là...

## text
💡 Donner des idées

## text
⚗️ Envie d'expérimenter

## blank white
Le monde du web, c'est pas que des gens qui font des SPA avec les fwk à la mode
> terminer sur le fait qu'il n'y a pas que JavaScript dans la vie

## text
🚨 Il n'y a pas que le<br>JavaScript dans la vie
> Et à la fin, ça va bien se passer.

## poster
*Merci beaucoup !* _vous êtes un super public..._

## credits

Liens :

* Source des composants : https://github.com/CleverCloud/clever-components
* Storybook des composants : https://www.clever-cloud.com/doc/clever-components/
* UI pour sélectionner : https://components.clever-cloud.com/
* Smart CDN source : https://github.com/CleverCloud/clever-components-cdn

* Références :

* Panneaux code de la route : https://fr.wikibooks.org/wiki/Code_de_la_route/Liste_des_panneaux

Images :

* Fond jungle : https://www.vexels.com/vectors/preview/70035/tropical-frame-styled-jungle-background
* Calendrier 2021 : https://unsplash.com/photos/F32jPy9SMaw
* Pangolin : https://unsplash.com/photos/mtTpAM2uaRM
* Antenne : https://unsplash.com/photos/31JqyCVndUM
* QR code : https://unsplash.com/photos/2HWkORIX3II
* Fond fête : https://www.vecteezy.com/vector-art/237001-party-crowd

Polices :

* Tintin : https://www.cufonfonts.com/font/tintin
* PT Sans : https://fonts.google.com/specimen/PT+Sans
* Anton : https://fonts.google.com/specimen/Anton
* Yanone Kaffeesatz : https://fonts.google.com/specimen/Yanone+Kaffeesatz
* Skranji : https://www.fontsc.com/font/skranji

Sons :

* Marimba note : https://www.youtube.com/watch?v=8FJMTJmuoU8
* Horn sound effect : https://www.youtube.com/watch?v=gKz1X2rn3CQ
* Forest sound : https://www.youtube.com/watch?v=IsPBplWLImI
